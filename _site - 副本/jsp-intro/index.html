<!DOCTYPE html>
<html xmlns:wb="http://open.weibo.com/wb">
<head>
    <!--   Author: NingG   -->
    <meta charset="utf-8" />
	<meta property="wb:webmaster" content="7ea7f3d5f3edad6a" />
    <title>JSP梳理 | ningg.top</title>
    <meta name="author" content="NingG" />
    <meta name="renderer" content="webkit">
    <meta name="description" content=" Java Server Pages，是运行在服务器端的语言，动态生成HTML  " />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">

    <link rel="stylesheet" href="/css/default.css" type="text/css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="alternate" type="application/atom+xml" title="Recent Entries" href="" />
	
    <script src="/js/jquery-1.7.1.min.js" type="text/javascript"></script>
	<script src="http://tjs.sjs.sinajs.cn/open/api/js/wb.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</head>
<body>
	
    <div class="home-menu">
        <div class="home-icon-con">
            <a class="home-menu-icon" href="/">NingG</a>
            <a class="home-follow" href="#" title="Contact Me">+</a>
        </div>
        <div class="home-contact">
            <a href="http://weibo.com/ggningg/" target="_blank" style="margin-left:-5px;"><img src="http://www.weibo.com/favicon.ico" alt="" width="25"/></a>
            <a href="http://www.douban.com/people/ggningg/" target="_blank" style="text-align:center;"><img src="http://www.douban.com/favicon.ico" alt="" width="22"/></a>
			<a href="http://github.com/ningg" alt="" target="_blank" style="text-align:right;"><img src="/images/icon-cube-smaller.png" width="22"/></a>
        </div>
    </div>

    <link rel="stylesheet" href="/js/prettify/prettify.css" />
<style type="text/css">
    body { background:#e8e8e8; }
    @media screen and (max-width: 750px){
        body { background:#fff; }
    }
    @media screen and (max-width: 1020px){
        body { background:#fff; }
    }
</style>

<div id="content">
    <div class="entry">
        <h1 class="entry-title"><a href="/jsp-intro" title="JSP梳理">JSP梳理</a></h1>
        <p class="entry-date">2012-04-20</p>
        <p>定位：</p>

<ul>
  <li>JSP文件的基本结构和语法；</li>
  <li>常用场景的说明；</li>
</ul>

<h2 id="section">简介</h2>

<p>JSP最终会生成servlet，在之前的<a href="/java-enterprise-edition/">博客</a>中有介绍；JSP页面的几个特点：</p>

<ul>
  <li>JSP编写页面，用于负责显示；</li>
  <li>JSP页面中，可以添加java代码；</li>
  <li>JSP页面提供丰富的标签；</li>
</ul>

<h2 id="jsp-">JSP 页面处理过程</h2>

<p>Web服务器，是如何利用JSP来创建动态网页的？<em>（参考下图）</em></p>

<ol>
  <li>服务器收到是JSP页面请求，转发给JSP引擎；<em>（JSP页面请求：由URL或.jsp文件来标识）</em></li>
  <li>JSP引擎，进行预处理：将JSP页面生成为java代码；</li>
  <li>JSP引擎，将java文件编译为class文件；</li>
  <li>编译后的class文件被加载到容器中，根据用户请求生成HTML格式的响应页面；</li>
</ol>

<p>本质上，执行JSP页面，分为两个阶段：</p>

<ul>
  <li>翻译阶段：Translation phase，JSP页面被翻译为Servlet类（java文件），然后编译为class文件；</li>
  <li>请求阶段：Request phase，class文件被加载执行后，响应前端的请求；</li>
</ul>

<p><img src="/images/jsp-intro/jsp-processing.jpg" alt="" /></p>

<p>本质上，JSP页面抽取了Servlet中包含的HTML标签信息<em>（out.write(“…html…”)）</em>，简化了Servlet的编写。</p>

<p>JSP引擎会检查JSP文件修改日期与Servlet的修改日期，如果JSP没有修改，则Servlet一直有效，即，只进行一次Servlet编译<em>（翻译阶段只进行一次）</em>。JSP和Servlet的执行速度是一样的。</p>

<h2 id="jsp--1">JSP 生命周期</h2>

<p>理解JSP底层功能的关键就是去理解它们所遵守的生命周期。</p>

<p>JSP生命周期就是从创建到销毁的整个过程，类似于servlet生命周期，区别在于JSP生命周期还包括将JSP文件编译成servlet。</p>

<p>以下是JSP生命周期中所走过的几个阶段：</p>

<ul>
  <li><strong>编译阶段</strong>：servlet容器编译servlet源文件，生成servlet类</li>
  <li><strong>初始化阶段</strong>：加载与JSP对应的servlet类，创建其实例，并调用它的初始化方法</li>
  <li><strong>执行阶段</strong>：调用与JSP对应的servlet实例的服务方法</li>
  <li><strong>销毁阶段</strong>：调用与JSP对应的servlet实例的销毁方法，然后销毁servlet实例</li>
</ul>

<p>很明显，JSP生命周期的四个主要阶段和servlet生命周期非常相似，下面给出图示：</p>

<p><img src="/images/jsp-intro/jsp_life_cycle.jpg" alt="" /></p>

<h3 id="jsp">JSP编译</h3>

<p>当浏览器请求JSP页面时，JSP引擎会首先去检查是否需要编译这个文件。如果这个文件没有被编译过，或者在上次编译后被更改过，则编译这个JSP文件。</p>

<p>编译的过程包括三个步骤：</p>

<ul>
  <li>解析JSP文件</li>
  <li>将JSP文件转为servlet</li>
  <li>编译servlet</li>
</ul>

<h3 id="jsp-1">JSP初始化</h3>

<p>容器载入JSP文件后，它会在为请求提供任何服务前调用<code>jspInit()</code>方法。如果您需要执行自定义的JSP初始化任务，复写<code>jspInit()</code>方法就行了，就像下面这样：</p>

<pre><code>public void jspInit(){
  // 初始化代码
}
</code></pre>

<p>一般来讲程序只初始化一次，servlet也是如此。通常情况下您可以在jspInit()方法中初始化数据库连接、打开文件和创建查询表。</p>

<h3 id="jsp-2">JSP执行</h3>

<p>这一阶段描述了JSP生命周期中一切与请求相关的交互行为，直到被销毁。</p>

<p>当JSP网页完成初始化后，JSP引擎将会调用<code>_jspService()</code>方法。</p>

<p><code>_jspService()</code>方法需要一个HttpServletRequest对象和一个HttpServletResponse对象作为它的参数，就像下面这样：</p>

<pre><code>void _jspService(HttpServletRequest request,
				 HttpServletResponse response)
{
   // 服务端处理代码
}
</code></pre>

<p><code>_jspService()</code>方法在每个request中被调用一次并且负责产生与之相对应的response，并且它还负责产生所有7个HTTP方法的回应，比如GET、POST、DELETE等等。</p>

<h3 id="jsp-3">JSP清理</h3>

<p>JSP生命周期的销毁阶段描述了当一个JSP网页从容器中被移除时所发生的一切。</p>

<p><code>jspDestroy()</code>方法在JSP中等价于servlet中的销毁方法。当您需要执行任何清理工作时复写<code>jspDestroy()</code>方法，比如释放数据库连接或者关闭文件夹等等。</p>

<p><code>jspDestroy()</code>方法的格式如下：</p>

<pre><code>public void jspDestroy()
{
   // 清理代码
}
</code></pre>

<h3 id="section-1">实例</h3>

<p>JSP生命周期代码实例如下所示：</p>

<pre><code>&lt;%@ page contentType="text/html; charset=GB2312" %&gt;
&lt;html&gt;&lt;head&gt;&lt;title&gt;life.jsp&lt;/title&gt;&lt;/head&gt;&lt;body&gt;

&lt;%! 
  private int initVar=0;
  private int serviceVar=0;
  private int destroyVar=0;
%&gt;
  
&lt;%!
  public void jspInit(){
	initVar++;
	System.out.println("jspInit(): JSP被初始化了"+initVar+"次");
  }
  public void jspDestroy(){
	destroyVar++;
	System.out.println("jspDestroy(): JSP被销毁了"+destroyVar+"次");
  }
%&gt;

&lt;%
  serviceVar++;
  System.out.println("_jspService(): JSP共响应了"+serviceVar+"次请求");

  String content1="初始化次数 : "+initVar;
  String content2="响应客户请求次数 : "+serviceVar;
  String content3="销毁次数 : "+destroyVar;
%&gt;

&lt;h1&gt;&lt;%=content1 %&gt;&lt;/h1&gt;
&lt;h1&gt;&lt;%=content2 %&gt;&lt;/h1&gt;
&lt;h1&gt;&lt;%=content3 %&gt;&lt;/h1&gt;

&lt;/body&gt;&lt;/html&gt;
</code></pre>

<p>思考：上述代码中，为什么要使用<code>&lt;%! .. %&gt;</code>，其中<code>!</code>的含义？</p>

<h2 id="jsp--2">JSP 语法</h2>

<h3 id="section-2">脚本程序（可执行代码）</h3>

<p>脚本程序可以包含任意量的Java语句、变量、方法或表达式，只要它们在脚本语言中是有效的。</p>

<ul>
  <li>脚本程序的语法格式：<code>&lt;% 代码片段 %&gt;</code>；</li>
  <li>任何文本、HTML标签、JSP元素必须写在脚本程序的外面；</li>
</ul>

<h3 id="jsp-4">JSP声明</h3>
<p>一个声明语句可以声明一个或多个变量、方法，供后面的Java代码使用。在JSP文件中，您必须先声明这些变量和方法然后才能使用它们。</p>

<p>JSP声明的语法格式：</p>

<pre><code>&lt;%! declaration; [ declaration; ]+ ... %&gt;
</code></pre>

<h3 id="jsp-5">JSP表达式</h3>

<p>一个JSP表达式中包含的脚本语言表达式，先被转化成String，然后插入到表达式出现的地方。</p>

<p>由于表达式的值会被转化成String，所以您可以在一个文本行中使用表达式而不用去管它是否是HTML标签。</p>

<p>表达式元素中可以包含任何符合Java语言规范的表达式，但是不能使用分号来结束表达式。</p>

<p>JSP表达式的语法格式：</p>

<pre><code>&lt;%= 表达式 %&gt;	
</code></pre>

<h3 id="jsp-6">JSP注释</h3>
<p>JSP注释主要有两个作用：为代码作注释以及将某段代码注释掉。</p>

<p>JSP注释的语法格式：</p>

<pre><code>&lt;%-- 这里可以填写 JSP 注释 --%&gt;
</code></pre>

<p>不同情况下使用注释的语法规则：</p>

<table>
  <thead>
    <tr>
      <th>语法</th>
      <th>描述</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>&lt;%-- 注释 --%&gt;</code></td>
      <td>JSP注释，注释内容不会被发送至浏览器甚至不会被编译</td>
    </tr>
    <tr>
      <td><code>&lt;!-- 注释 --&gt;	</code></td>
      <td>HTML注释，通过浏览器查看网页源代码时可以看见注释内容</td>
    </tr>
  </tbody>
</table>

<h3 id="jsp-7">JSP指令</h3>

<p>JSP指令用来设置与整个JSP页面相关的属性。</p>

<p>JSP指令语法格式：</p>

<pre><code>&lt;%@ directive attribute="value" %&gt;
</code></pre>

<p>这里有三种指令标签：</p>

<table>
  <thead>
    <tr>
      <th>指令</th>
      <th>描述</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>&lt;%@ page ... %&gt;</code></td>
      <td>定义页面的依赖属性，比如脚本语言、error页面、缓存需求等等</td>
    </tr>
    <tr>
      <td><code>&lt;%@ include ... %&gt;</code></td>
      <td>包含其他文件</td>
    </tr>
    <tr>
      <td><code>&lt;%@ taglib ... %&gt;	</code></td>
      <td>引入标签库的定义，可以是自定义标签</td>
    </tr>
  </tbody>
</table>

<h4 id="page">Page指令</h4>

<p>Page指令为容器提供当前页面的使用说明。一个JSP页面可以包含多个page指令。</p>

<p>Page指令的语法格式：</p>

<pre><code>&lt;%@ page attribute="value" %&gt;
</code></pre>

<h5 id="section-3">属性</h5>

<p>下表列出与Page指令相关的属性：</p>

<table>
  <thead>
    <tr>
      <th>属性</th>
      <th>描述</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>buffer</td>
      <td>指定out对象使用缓冲区的大小</td>
    </tr>
    <tr>
      <td>autoFlush</td>
      <td>控制out对象的 缓存区</td>
    </tr>
    <tr>
      <td>contentType</td>
      <td>指定当前JSP页面的MIME类型和字符编码</td>
    </tr>
    <tr>
      <td>errorPage</td>
      <td>指定当JSP页面发生异常时需要转向的错误处理页面</td>
    </tr>
    <tr>
      <td>isErrorPage</td>
      <td>指定当前页面是否可以作为另一个JSP页面的错误处理页面</td>
    </tr>
    <tr>
      <td>extends</td>
      <td>指定servlet从哪一个类继承</td>
    </tr>
    <tr>
      <td>import</td>
      <td>导入要使用的Java类</td>
    </tr>
    <tr>
      <td>info</td>
      <td>定义JSP页面的描述信息</td>
    </tr>
    <tr>
      <td>isThreadSafe</td>
      <td>指定对JSP页面的访问是否为线程安全</td>
    </tr>
    <tr>
      <td>language</td>
      <td>定义JSP页面所用的脚本语言，默认是Java</td>
    </tr>
    <tr>
      <td>session</td>
      <td>指定JSP页面是否使用session</td>
    </tr>
    <tr>
      <td>isELIgnored</td>
      <td>指定是否执行EL表达式</td>
    </tr>
    <tr>
      <td>isScriptingEnabled</td>
      <td>确定脚本元素能否被使用</td>
    </tr>
    <tr>
      <td>pageEncoding</td>
      <td>设定JSP页面编码方式</td>
    </tr>
  </tbody>
</table>

<h4 id="include">Include指令</h4>

<p>JSP可以通过include指令来包含其他文件。被包含的文件可以是JSP文件、HTML文件或文本文件。包含的文件就好像是该JSP文件的一部分，会被同时编译执行。</p>

<p>Include指令的语法格式如下：</p>

<pre><code>&lt;%@ include file="relative url" %&gt;
</code></pre>

<h4 id="taglib">Taglib指令</h4>

<p>JSP API允许用户自定义标签，一个自定义标签库就是自定义标签的集合。</p>

<p>Taglib指令引入一个自定义标签集合的定义，包括库路径、自定义标签。</p>

<p>Taglib指令的语法：</p>

<pre><code>&lt;%@ taglib uri="uri" prefix="prefixOfTag" %&gt;
</code></pre>

<p>uri属性确定标签库的位置，prefix属性指定标签库的前缀。</p>

<h3 id="jsp--3">JSP 动作元素</h3>

<p>与JSP指令元素不同的是，JSP动作元素在<code>请求处理阶段</code>起作用<em>（还有一个阶段：翻译阶段）</em>。它能够动态插入一个文件，重用JavaBean组件，引导用户去另一个页面，为Java插件产生相关的HTML等等。</p>

<p>行为标签只有一种语法格式，它严格遵守XML标准：</p>

<pre><code>&lt;jsp:action_name attribute="value" /&gt;
</code></pre>

<p>行为标签基本上是一些预先就定义好的函数，下表罗列出了一些可用的JSP行为标签：：</p>

<table>
  <thead>
    <tr>
      <th>语法</th>
      <th>描述</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>jsp:include</code></td>
      <td>用于在当前页面中包含静态或动态资源</td>
    </tr>
    <tr>
      <td><code>jsp:useBean</code></td>
      <td>寻找和初始化一个JavaBean组件</td>
    </tr>
    <tr>
      <td><code>jsp:setProperty</code></td>
      <td>设置 JavaBean组件的值</td>
    </tr>
    <tr>
      <td><code>jsp:getProperty</code></td>
      <td>将 JavaBean组件的值插入到 output中</td>
    </tr>
    <tr>
      <td><code>jsp:forward</code></td>
      <td>从一个JSP文件向另一个文件传递一个包含用户请求的request对象</td>
    </tr>
    <tr>
      <td><code>jsp:plugin</code></td>
      <td>用于在生成的HTML页面中包含Applet和JavaBean对象</td>
    </tr>
    <tr>
      <td><code>jsp:element</code></td>
      <td>动态创建一个XML元素</td>
    </tr>
    <tr>
      <td><code>jsp:attribute</code></td>
      <td>定义动态创建的XML元素的属性</td>
    </tr>
    <tr>
      <td><code>jsp:body</code></td>
      <td>定义动态创建的XML元素的主体</td>
    </tr>
    <tr>
      <td><code>jsp:text</code></td>
      <td>用于封装模板数据</td>
    </tr>
  </tbody>
</table>

<h3 id="jsp-8">JSP隐含对象</h3>

<p>JSP支持 9 个隐含对象，又称预定义变量，即，JSP容器为每个页面提供的Java对象，可直接使用：</p>

<table>
  <thead>
    <tr>
      <th>对象</th>
      <th>描述</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>request</td>
      <td>HttpServletRequest类的实例</td>
    </tr>
    <tr>
      <td>response</td>
      <td>HttpServletResponse类的实例</td>
    </tr>
    <tr>
      <td>out</td>
      <td>PrintWriter类的实例，用于把结果输出至网页上</td>
    </tr>
    <tr>
      <td>session</td>
      <td>HttpSession类的实例</td>
    </tr>
    <tr>
      <td>application</td>
      <td>ServletContext类的实例，与应用上下文有关</td>
    </tr>
    <tr>
      <td>config</td>
      <td>ServletConfig类的实例</td>
    </tr>
    <tr>
      <td>pageContext</td>
      <td>PageContext类的实例，提供对JSP页面所有对象以及命名空间的访问</td>
    </tr>
    <tr>
      <td>page</td>
      <td>类似于Java类中的this关键字</td>
    </tr>
    <tr>
      <td>Exception</td>
      <td>Exception类的对象，代表发生错误的JSP页面中对应的异常对象</td>
    </tr>
  </tbody>
</table>

<p>Todo：</p>

<ul>
  <li>单独写一篇，内置对象的使用和简介；</li>
  <li>spring mvc使用过程中，是否设计这些对象？</li>
</ul>

<h2 id="section-4">常见问题</h2>

<h3 id="jspjava">jsp中插入java代码</h3>

<p>插入java代码方式如下：<code>&lt;% ... %&gt;</code>，例如：</p>

<pre><code>&lt;body&gt;
	&lt;% out.pringln("Hello World!"); %&gt;
&lt;/body&gt;
</code></pre>

<h2 id="section-5">参考来源</h2>

<ul>
  <li><a href="https://jcp.org/en/jsr/detail?id=245" title="JSR 245: JavaServerTM Pages 2.1">JavaServet Pages 官方规范-JSR245</a></li>
  <li><a href="http://www.w3cschool.cc/jsp/jsp-tutorial.html">JSP-tutorial</a> <em>（大部分内容，来自此处）</em></li>
</ul>



        <div id="disqus_container">
            <div style="margin-bottom:20px" class="right">
				<wb:share-button appkey="2306590132" addition="simple" type="button" ralateUid="2356527183"></wb:share-button>
            </div>
            <!--<a href="#" class="comment" onclick="return false;">点击查看评论</a>-->
            <div id="disqus_thread"></div>
        </div>
    </div>

	
    <div class="sidenav">
		<iframe width="100%" height="75" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=550&fansRow=2&ptype=1&speed=0&skin=1&isTitle=0&noborder=0&isWeibo=0&isFans=0&uid=2356527183&verifier=1ccfb61e&colors=d6f3f7,ffffff,666666,0082cb,ecfbfd&dpc=1"></iframe>
    </div>

</div>

<script src="/js/post.js" type="text/javascript"></script>


	<div id="gotoTop">Top</div>


    <!--*********************************************************-->
    <!--****** 宝贝儿，看见这个时候，删掉下面的统计代码哦~ ******-->
    <!--*********************************************************-->
	<script>
	  (function(i,s,o,g,r,a,m){
		  i['GoogleAnalyticsObject']=r;i[r]=i[r] || function(){
			(i[r].q=i[r].q||[]).push(arguments)}, i[r].l=1*new Date();
			a=s.createElement(o), m=s.getElementsByTagName(o)[0];
			a.async=1;
			a.src=g;
			m.parentNode.insertBefore(a,m)
	  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	  ga('create', 'UA-48535193-1', 'ningg.github.io');
	  ga('send', 'pageview');
	</script>
    
	
    <script type="text/javascript">
		function gotoTop(min_height){
			$("#gotoTop").click(
				function(){$('html,body').animate({scrollTop:0},700);
			}).hover(
				function(){$(this).addClass("hover");},
				function(){$(this).removeClass("hover");
			});
			min_height ? min_height = min_height : min_height = 600;
			$(window).scroll(function(){
				
				var s = $(window).scrollTop();
				
				if( s > min_height){
					$("#gotoTop").fadeIn(100);
				}else{
					$("#gotoTop").fadeOut(200);
				};
			});
		};
		gotoTop();

        $(function(){
            $('.home-follow').click(function(e){
                e.preventDefault();

                if($('.home-contact').is(':visible')){
                    $('.home-contact').slideUp(100);
                }else{
                    $('.home-contact').slideDown(100);
                }
            });
        })

    </script>
</body>
</html>
