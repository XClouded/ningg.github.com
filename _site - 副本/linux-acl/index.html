<!DOCTYPE html>
<html xmlns:wb="http://open.weibo.com/wb">
<head>
    <!--   Author: NingG   -->
    <meta charset="utf-8" />
	<meta property="wb:webmaster" content="7ea7f3d5f3edad6a" />
    <title>ACL入门 | ningg.top</title>
    <meta name="author" content="NingG" />
    <meta name="renderer" content="webkit">
    <meta name="description" content=" ACL是什么？  " />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">

    <link rel="stylesheet" href="/css/default.css" type="text/css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="alternate" type="application/atom+xml" title="Recent Entries" href="" />
	
    <script src="/js/jquery-1.7.1.min.js" type="text/javascript"></script>
	<script src="http://tjs.sjs.sinajs.cn/open/api/js/wb.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</head>
<body>
	
    <div class="home-menu">
        <div class="home-icon-con">
            <a class="home-menu-icon" href="/">NingG</a>
            <a class="home-follow" href="#" title="Contact Me">+</a>
        </div>
        <div class="home-contact">
            <a href="http://weibo.com/ggningg/" target="_blank" style="margin-left:-5px;"><img src="http://www.weibo.com/favicon.ico" alt="" width="25"/></a>
            <a href="http://www.douban.com/people/ggningg/" target="_blank" style="text-align:center;"><img src="http://www.douban.com/favicon.ico" alt="" width="22"/></a>
			<a href="http://github.com/ningg" alt="" target="_blank" style="text-align:right;"><img src="/images/icon-cube-smaller.png" width="22"/></a>
        </div>
    </div>

    <link rel="stylesheet" href="/js/prettify/prettify.css" />
<style type="text/css">
    body { background:#e8e8e8; }
    @media screen and (max-width: 750px){
        body { background:#fff; }
    }
    @media screen and (max-width: 1020px){
        body { background:#fff; }
    }
</style>

<div id="content">
    <div class="entry">
        <h1 class="entry-title"><a href="/linux-acl" title="ACL入门">ACL入门</a></h1>
        <p class="entry-date">2014-08-14</p>
        <h2 id="section">背景</h2>

<p>文件系统上，文件权限管理的时候，通常有一个词语：ACL。ACL到底是什么？</p>

<h2 id="section-1">是什么</h2>

<p>（侧重于ACL能做什么事）</p>

<p>ACL（<code>Access Control List</code>，访问控制列表），并不用于设定<code>文件</code>/<code>目录</code>的owner、group、others的read、write、execute（<code>r</code>,<code>w</code>,<code>x</code>）权限，而是除此权限设置之外的更细节的权限设置。</p>

<p>特别说明：实际上，ACL也可以设置文件owner、group、others对应的<code>r</code>/<code>w</code>/<code>e</code>权限，但我们通常使用<code>chmod</code>命令来实现此功能，而倾向将ACL用于除此之外的权限设置。</p>

<p>ACL设定的权限主要有：</p>

<ol>
  <li>使用者（<code>user</code>）：设置某个使用者（<code>user</code>）读、写、执行一个文件的权限；解释：此处的<code>user</code>，不是<code>owner</code>，而是其他的用户；</li>
  <li>群组（<code>group</code>）：设置某个群组（<code>group</code>）读、写、执行一个文件的权限；解释：此处的<code>group</code>不是指，文件对应的<code>owning group</code>的执行权限，而是除<code>owning group</code>之外的其他<code>group</code>，操作此文件的权限；</li>
  <li>默认属性（<code>mask</code>）：设定某一个<code>目录</code>之下，新建<code>文件</code>/<code>目录</code>时，这些新建的<code>文件</code>/<code>目录</code>的默认权限;</li>
</ol>

<p>（上面内容有待补充）</p>

<h2 id="section-2">怎么用</h2>

<p>ACL（<code>访问控制列表</code>），是Unix-like操作系统权限的额外支持项目，需要文件系统（<code>File System</code>）的支持。当前大部分文件系统都支持ACL，例如：EXT2/3
、JFS、XFS等。</p>

<h3 id="acl">是否支持ACL</h3>

<p>使用命令<code>dumpe2fs -h /dev/sda1</code>查看某一分区上文件系统是否支持ACL，例如：</p>

<pre><code>[root@localhost devp]# dumpe2fs -h /dev/sda1
dumpe2fs 1.41.12 (17-May-2010)
...
Default mount options:    user_xattr acl
...
</code></pre>

<p>注：<code>dumpe2fs</code>含义：dump ext2/ext3/ext4 filesystem information.	</p>

<h3 id="acl-1">是否启用ACL</h3>

<p>文件系统支持ACL，即有能力开启ACL，但是文件系统需要开启ACL，通过如下方式来查询是否开启ACL：</p>

<pre><code># 直接参阅挂载参数
[root@localhost ~]# mount
proc on /proc type proc (rw)
sysfs on /sys type sysfs (rw)
tmpfs on /dev/shm type tmpfs (rw)
/dev/sda1 on /boot type ext4 (rw)
</code></pre>

<p>备注：“是否支持ACL”和“是否启用ACL”这两部分，自己理解不能肯定，需要补充。</p>

<h3 id="section-3">两个命令</h3>

<p>filesystem启动ACL支持之后，就可以设定和查看ACL了，主要是两条命令：</p>

<ul>
  <li><code>getfacl</code>：查看文件的ACL；</li>
  <li><code>setfacl</code>：设置文件的ACL；</li>
</ul>

<p>这两个命令侧重于使用命令：<code>man [COMMAND]</code>来查看命令细节。两个命令相互配合使用，通常<code>setfacl</code>之后，跟着一个<code>getfacl</code>来查看设置是否成功。</p>

<h3 id="section-4">几个场景和实例</h3>

<h4 id="section-5">简介</h4>

<p><code>setfacl</code>：<code>set file access control list</code>，设置ACL。命令详情如下：</p>

<pre><code>[superman@localhost /]$ setfacl --help
setfacl 2.2.49 -- `set file access control lists`
Usage: setfacl [-bkndRLP] { -m|-M|-x|-X ... } file ...
  -m, --modify=acl        modify the current ACL(s) of file(s)
  -M, --modify-file=file  read ACL entries to modify from file
  -x, --remove=acl        remove entries from the ACL(s) of file(s)
  -X, --remove-file=file  read ACL entries to remove from file
  -b, --remove-all        remove all extended ACL entries
  -k, --remove-default    remove the default ACL
	  --set=acl           set the ACL of file(s), replacing the current ACL
	  --set-file=file     read ACL entries to set from file
	  --mask              do recalculate the effective rights mask
  -n, --no-mask           don't recalculate the effective rights mask
  -d, --default           operations apply to the default ACL
  -R, --recursive         recurse into subdirectories
  -L, --logical           logical walk, follow symbolic links
  -P, --physical          physical walk, do not follow symbolic links
	  --restore=file      restore ACLs (inverse of `getfacl -R')
	  --test              test mode (ACLs are not modified)
  -v, --version           print version and exit
  -h, --help              this help text
</code></pre>

<p><code>getfacl</code>：<code>get file access control lists</code>，查看ACL。命令详情如下：</p>

<pre><code>[god@localhost /]$ getfacl -h
getfacl 2.2.49 -- get file access control lists
Usage: getfacl [-aceEsRLPtpndvh] file ...
  -a,  --access           display the file access control list only
  -d, --default           display the default access control list only
  -c, --omit-header       do not display the comment header
  -e, --all-effective     print all effective rights
  -E, --no-effective      print no effective rights
  -s, --skip-base         skip files that only have the base entries
  -R, --recursive         recurse into subdirectories
  -L, --logical           logical walk, follow symbolic links
  -P, --physical          physical walk, do not follow symbolic links
  -t, --tabular           use tabular output format
  -n, --numeric           print numeric user/group identifiers
  -p, --absolute-names    don't strip leading '/' in pathnames
  -v, --version           print version and exit
  -h, --help              this help text
</code></pre>

<h4 id="user">场景1：设置user权限</h4>

<blockquote>
  <p>场景描述：让devp用户获取查看<code>/root</code>目录的权限。</p>
</blockquote>

<p>设置user权限的命令如下：</p>

<pre><code>setfacl -m u:devp:rx /root
</code></pre>

<p>查看结果：</p>

<pre><code>// 查看目录详情（不是目录下内容列表）
// 查询结果中`dr-xr-x---+`，最后的`+`表示有ACL附加权限；
[god@localhost /]# ll -d root
dr-xr-x---+ 18 root root 4096 Aug  5 09:32 root
// 查看ACL详情
[god@localhost /]# getfacl root
# file: root 
# owner: root
# group: root
user::r-x       //`owner`的权限
user:devp:r-x   //用户`devp`的权限（ACL设置的细节）
group::r-x      //`owning group`的权限
mask::r-x       //什么含义？（ACL设置的细节）
other::---
</code></pre>

<h4 id="user-1">场景2：取消user权限</h4>

<blockquote>
  <p>场景描述：在场景1中设置了devp用户查看<code>/root</code>目录的权限，如何取消devp用户的这一权限呢？</p>
</blockquote>

<p>取消<code>user</code>权限的命令如下：</p>

<pre><code>setfacl -x u:devp /root
</code></pre>

<p>查看结果：</p>

<pre><code>// 查看ACL详情
[god@localhost /]# getfacl root
# file: root 
# owner: root
# group: root
user::r-x       //`owner`的权限
group::r-x      //`owning group`的权限
mask::r-x       
other::---
</code></pre>

<h4 id="group">场景3：设置group权限</h4>

<blockquote>
  <p>场景描述：如何设置<code>devp</code>组拥有<code>/root</code>目录的查看权限？</p>
</blockquote>

<p>设置命令：</p>

<pre><code>set -m g:devp:rx /root
</code></pre>

<p>查询结果：</p>

<p>（未完待续，各个典型场景）	</p>

<h2 id="section-6">什么原理</h2>

<p>（参考：Hadoop技术内幕中HDFS的架构设计与实现原理）</p>

<h2 id="hdfsacl">HDFS中的ACL</h2>

<p>Hadoop从2.4.0版本开始支持ACL（英文原版的出处），并且已经有人对此进行了测试：http://blog.csdn.net/j2eelamp/article/details/24594159</p>



        <div id="disqus_container">
            <div style="margin-bottom:20px" class="right">
				<wb:share-button appkey="2306590132" addition="simple" type="button" ralateUid="2356527183"></wb:share-button>
            </div>
            <!--<a href="#" class="comment" onclick="return false;">点击查看评论</a>-->
            <div id="disqus_thread"></div>
        </div>
    </div>

	
    <div class="sidenav">
		<iframe width="100%" height="75" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=550&fansRow=2&ptype=1&speed=0&skin=1&isTitle=0&noborder=0&isWeibo=0&isFans=0&uid=2356527183&verifier=1ccfb61e&colors=d6f3f7,ffffff,666666,0082cb,ecfbfd&dpc=1"></iframe>
    </div>

</div>

<script src="/js/post.js" type="text/javascript"></script>


	<div id="gotoTop">Top</div>


    <!--*********************************************************-->
    <!--****** 宝贝儿，看见这个时候，删掉下面的统计代码哦~ ******-->
    <!--*********************************************************-->
	<script>
	  (function(i,s,o,g,r,a,m){
		  i['GoogleAnalyticsObject']=r;i[r]=i[r] || function(){
			(i[r].q=i[r].q||[]).push(arguments)}, i[r].l=1*new Date();
			a=s.createElement(o), m=s.getElementsByTagName(o)[0];
			a.async=1;
			a.src=g;
			m.parentNode.insertBefore(a,m)
	  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	  ga('create', 'UA-48535193-1', 'ningg.github.io');
	  ga('send', 'pageview');
	</script>
    
	
    <script type="text/javascript">
		function gotoTop(min_height){
			$("#gotoTop").click(
				function(){$('html,body').animate({scrollTop:0},700);
			}).hover(
				function(){$(this).addClass("hover");},
				function(){$(this).removeClass("hover");
			});
			min_height ? min_height = min_height : min_height = 600;
			$(window).scroll(function(){
				
				var s = $(window).scrollTop();
				
				if( s > min_height){
					$("#gotoTop").fadeIn(100);
				}else{
					$("#gotoTop").fadeOut(200);
				};
			});
		};
		gotoTop();

        $(function(){
            $('.home-follow').click(function(e){
                e.preventDefault();

                if($('.home-contact').is(':visible')){
                    $('.home-contact').slideUp(100);
                }else{
                    $('.home-contact').slideDown(100);
                }
            });
        })

    </script>
</body>
</html>
