<!DOCTYPE html>
<html xmlns:wb="http://open.weibo.com/wb">
<head>
    <!--   Author: NingG   -->
    <meta charset="utf-8" />
	<meta property="wb:webmaster" content="7ea7f3d5f3edad6a" />
    <title>Flume 1.5.0.1 User Guide：Monitoring | ningg.top</title>
    <meta name="author" content="NingG" />
    <meta name="renderer" content="webkit">
    <meta name="description" content=" Flume中Monitoring部分的详细介绍  " />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">

    <link rel="stylesheet" href="/css/default.css" type="text/css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="alternate" type="application/atom+xml" title="Recent Entries" href="" />
	
    <script src="/js/jquery-1.7.1.min.js" type="text/javascript"></script>
	<script src="http://tjs.sjs.sinajs.cn/open/api/js/wb.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</head>
<body>
	
    <div class="home-menu">
        <div class="home-icon-con">
            <a class="home-menu-icon" href="/">NingG</a>
            <a class="home-follow" href="#" title="Contact Me">+</a>
        </div>
        <div class="home-contact">
            <a href="http://weibo.com/ggningg/" target="_blank" style="margin-left:-5px;"><img src="http://www.weibo.com/favicon.ico" alt="" width="25"/></a>
            <a href="http://www.douban.com/people/ggningg/" target="_blank" style="text-align:center;"><img src="http://www.douban.com/favicon.ico" alt="" width="22"/></a>
			<a href="http://github.com/ningg" alt="" target="_blank" style="text-align:right;"><img src="/images/icon-cube-smaller.png" width="22"/></a>
        </div>
    </div>

    <link rel="stylesheet" href="/js/prettify/prettify.css" />
<style type="text/css">
    body { background:#e8e8e8; }
    @media screen and (max-width: 750px){
        body { background:#fff; }
    }
    @media screen and (max-width: 1020px){
        body { background:#fff; }
    }
</style>

<div id="content">
    <div class="entry">
        <h1 class="entry-title"><a href="/flume-user-guide-monitoring" title="Flume 1.5.0.1 User Guide：Monitoring">Flume 1.5.0.1 User Guide：Monitoring</a></h1>
        <p class="entry-date">2014-12-03</p>
        <p>Monitoring in Flume is still a work in progress. Changes can happen very often. Several Flume components report metrics to the JMX platform MBean server. These metrics can be queried using Jconsole.
（当前Flume的Monitoring最终方案没有敲定，期间会多次改版，注意关注JIRA；另，几个Flume components会向JMX platform MBean server提交运行参数，可以通过JMX获取这几个Flume components的运行状态。）</p>

<p><strong>notes(ningg)</strong>：JVM上两个东西，什么用途？<strong>JMX platform</strong>、<strong>MBean server</strong>。</p>

<h2 id="ganglia-reporting">Ganglia Reporting</h2>

<p>Flume can also report these metrics to Ganglia 3 or Ganglia 3.1 metanodes. To report metrics to Ganglia, a flume agent must be started with this support. The Flume agent has to be started by passing in the following parameters as system properties prefixed by flume.monitoring., and can be specified in the <code>flume-env.sh</code>:</p>

<table>
  <thead>
    <tr>
      <th>Property Name</th>
      <th>Default</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>type</strong></td>
      <td>–</td>
      <td>The component type name, has to be <code>ganglia</code></td>
    </tr>
    <tr>
      <td><strong>hosts</strong></td>
      <td>–</td>
      <td>Comma-separated list of <code>hostname:port</code> of Ganglia servers</td>
    </tr>
    <tr>
      <td>pollFrequency</td>
      <td>60</td>
      <td>Time, in seconds, between consecutive reporting to Ganglia server</td>
    </tr>
    <tr>
      <td>isGanglia3</td>
      <td>false</td>
      <td>Ganglia server version is 3. By default, Flume sends in Ganglia 3.1 format</td>
    </tr>
  </tbody>
</table>

<p>We can start Flume with Ganglia support as follows:</p>

<pre><code>$ bin/flume-ng agent --conf-file example.conf --name a1 -Dflume.monitoring.type=ganglia -Dflume.monitoring.hosts=com.example:1234,com.example2:5455
</code></pre>

<p><strong>notes(ningg)</strong>：在<code>conf/flume-env.sh</code>文件中配置Ganglia监控，具体配置选项：</p>

<pre><code># Flume Monitoring: Ganglia Monitoring
JAVA_OPTS="-Dflume.monitoring.type=ganglia -Dflume.monitoring.hosts=239.2.11.166:8649"
</code></pre>

<h2 id="json-reporting">JSON Reporting</h2>

<p>Flume can also report metrics in a JSON format. To enable reporting in JSON format, Flume hosts a Web server on a configurable port. Flume reports metrics in the following JSON format:</p>

<pre><code>{
"typeName1.componentName1" : {"metric1" : "metricValue1", "metric2" : "metricValue2"},
"typeName2.componentName2" : {"metric3" : "metricValue3", "metric4" : "metricValue4"}
}
</code></pre>

<p>Here is an example:</p>

<pre><code>{
"CHANNEL.fileChannel":{"EventPutSuccessCount":"468085",
					  "Type":"CHANNEL",
					  "StopTime":"0",
					  "EventPutAttemptCount":"468086",
					  "ChannelSize":"233428",
					  "StartTime":"1344882233070",
					  "EventTakeSuccessCount":"458200",
					  "ChannelCapacity":"600000",
					  "EventTakeAttemptCount":"458288"},
"CHANNEL.memChannel":{"EventPutSuccessCount":"22948908",
				   "Type":"CHANNEL",
				   "StopTime":"0",
				   "EventPutAttemptCount":"22948908",
				   "ChannelSize":"5",
				   "StartTime":"1344882209413",
				   "EventTakeSuccessCount":"22948900",
				   "ChannelCapacity":"100",
				   "EventTakeAttemptCount":"22948908"}
}
</code></pre>

<table>
  <thead>
    <tr>
      <th>Property Name</th>
      <th>Default</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>type</strong></td>
      <td>–</td>
      <td>The component type name, has to be <code>http</code></td>
    </tr>
    <tr>
      <td>port</td>
      <td>41414</td>
      <td>The port to start the server on.</td>
    </tr>
  </tbody>
</table>

<p>We can start Flume with JSON Reporting support as follows:</p>

<pre><code>$ bin/flume-ng agent --conf-file example.conf --name a1 -Dflume.monitoring.type=http -Dflume.monitoring.port=34545
</code></pre>

<p>Metrics will then be available at <code>http://&lt;hostname&gt;:&lt;port&gt;/metrics</code> webpage. Custom components can report metrics as mentioned in the Ganglia section above.</p>

<h2 id="custom-reporting">Custom Reporting</h2>

<p>It is possible to report metrics to other systems by writing servers that do the reporting. Any reporting class has to implement the interface, <code>org.apache.flume.instrumentation.MonitorService</code>. Such a class can be used the same way the <code>GangliaServer</code> is used for reporting. They can poll the platform mbean server to poll the mbeans for metrics. For example, if an HTTP monitoring service called <code>HTTPReporting</code> can be used as follows:</p>

<p><strong>notes(ningg)</strong>：MBean是什么？其中可以获取metrics？</p>

<pre><code>$ bin/flume-ng agent --conf-file example.conf --name a1 \
-Dflume.monitoring.type=com.example.reporting.HTTPReporting \
-Dflume.monitoring.node=com.example:332
</code></pre>

<table>
  <thead>
    <tr>
      <th>Property Name</th>
      <th>Default	Description</th>
      <th> </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>type</td>
      <td>–</td>
      <td>The component type name, has to be FQCN</td>
    </tr>
  </tbody>
</table>

<h2 id="reporting-metrics-from-custom-components">Reporting metrics from custom components</h2>

<p>Any custom flume components should inherit from the <code>org.apache.flume.instrumentation.MonitoredCounterGroup</code> class. The class should then provide <code>getter methods</code> for each of the metrics it exposes. See the code below. The MonitoredCounterGroup expects a list of attributes whose metrics are exposed by this class. As of now, this class only supports exposing metrics as long values.</p>

<pre><code>public class SinkCounter extends MonitoredCounterGroup implements
	SinkCounterMBean {

  private static final String COUNTER_CONNECTION_CREATED =
	"sink.connection.creation.count";

  private static final String COUNTER_CONNECTION_CLOSED =
	"sink.connection.closed.count";

  private static final String COUNTER_CONNECTION_FAILED =
	"sink.connection.failed.count";

  private static final String COUNTER_BATCH_EMPTY =
	"sink.batch.empty";

  private static final String COUNTER_BATCH_UNDERFLOW =
	  "sink.batch.underflow";

  private static final String COUNTER_BATCH_COMPLETE =
	"sink.batch.complete";

  private static final String COUNTER_EVENT_DRAIN_ATTEMPT =
	"sink.event.drain.attempt";

  private static final String COUNTER_EVENT_DRAIN_SUCCESS =
	"sink.event.drain.sucess";

  private static final String[] ATTRIBUTES = {
	COUNTER_CONNECTION_CREATED, COUNTER_CONNECTION_CLOSED,
	COUNTER_CONNECTION_FAILED, COUNTER_BATCH_EMPTY,
	COUNTER_BATCH_UNDERFLOW, COUNTER_BATCH_COMPLETE,
	COUNTER_EVENT_DRAIN_ATTEMPT, COUNTER_EVENT_DRAIN_SUCCESS
  };


  public SinkCounter(String name) {
	super(MonitoredCounterGroup.Type.SINK, name, ATTRIBUTES);
  }

  @Override
  public long getConnectionCreatedCount() {
	return get(COUNTER_CONNECTION_CREATED);
  }

  public long incrementConnectionCreatedCount() {
	return increment(COUNTER_CONNECTION_CREATED);
  }

}
</code></pre>



        <div id="disqus_container">
            <div style="margin-bottom:20px" class="right">
				<wb:share-button appkey="2306590132" addition="simple" type="button" ralateUid="2356527183"></wb:share-button>
            </div>
            <!--<a href="#" class="comment" onclick="return false;">点击查看评论</a>-->
            <div id="disqus_thread"></div>
        </div>
    </div>

	
    <div class="sidenav">
		<iframe width="100%" height="75" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=550&fansRow=2&ptype=1&speed=0&skin=1&isTitle=0&noborder=0&isWeibo=0&isFans=0&uid=2356527183&verifier=1ccfb61e&colors=d6f3f7,ffffff,666666,0082cb,ecfbfd&dpc=1"></iframe>
    </div>

</div>

<script src="/js/post.js" type="text/javascript"></script>


	<div id="gotoTop">Top</div>


    <!--*********************************************************-->
    <!--****** 宝贝儿，看见这个时候，删掉下面的统计代码哦~ ******-->
    <!--*********************************************************-->
	<script>
	  (function(i,s,o,g,r,a,m){
		  i['GoogleAnalyticsObject']=r;i[r]=i[r] || function(){
			(i[r].q=i[r].q||[]).push(arguments)}, i[r].l=1*new Date();
			a=s.createElement(o), m=s.getElementsByTagName(o)[0];
			a.async=1;
			a.src=g;
			m.parentNode.insertBefore(a,m)
	  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	  ga('create', 'UA-48535193-1', 'ningg.github.io');
	  ga('send', 'pageview');
	</script>
    
	
    <script type="text/javascript">
		function gotoTop(min_height){
			$("#gotoTop").click(
				function(){$('html,body').animate({scrollTop:0},700);
			}).hover(
				function(){$(this).addClass("hover");},
				function(){$(this).removeClass("hover");
			});
			min_height ? min_height = min_height : min_height = 600;
			$(window).scroll(function(){
				
				var s = $(window).scrollTop();
				
				if( s > min_height){
					$("#gotoTop").fadeIn(100);
				}else{
					$("#gotoTop").fadeOut(200);
				};
			});
		};
		gotoTop();

        $(function(){
            $('.home-follow').click(function(e){
                e.preventDefault();

                if($('.home-contact').is(':visible')){
                    $('.home-contact').slideUp(100);
                }else{
                    $('.home-contact').slideDown(100);
                }
            });
        })

    </script>
</body>
</html>
