<!DOCTYPE html>
<html xmlns:wb="http://open.weibo.com/wb">
<head>
    <!--   Author: NingG   -->
    <meta charset="utf-8" />
	<meta property="wb:webmaster" content="7ea7f3d5f3edad6a" />
    <title>MySQL字符编码和大小写敏感问题 | ningg.top</title>
    <meta name="author" content="NingG" />
    <meta name="renderer" content="webkit">
    <meta name="description" content=" 没有系统整理过MySQL知识，先这样零散地整理了  " />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">

    <link rel="stylesheet" href="/css/default.css" type="text/css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="alternate" type="application/atom+xml" title="Recent Entries" href="" />
	
    <script src="/js/jquery-1.7.1.min.js" type="text/javascript"></script>
	<script src="http://tjs.sjs.sinajs.cn/open/api/js/wb.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</head>
<body>
	
    <div class="home-menu">
        <div class="home-icon-con">
            <a class="home-menu-icon" href="/">NingG</a>
            <a class="home-follow" href="#" title="Contact Me">+</a>
        </div>
        <div class="home-contact">
            <a href="http://weibo.com/ggningg/" target="_blank" style="margin-left:-5px;"><img src="http://www.weibo.com/favicon.ico" alt="" width="25"/></a>
            <a href="http://www.douban.com/people/ggningg/" target="_blank" style="text-align:center;"><img src="http://www.douban.com/favicon.ico" alt="" width="22"/></a>
			<a href="http://github.com/ningg" alt="" target="_blank" style="text-align:right;"><img src="/images/icon-cube-smaller.png" width="22"/></a>
        </div>
    </div>

    <link rel="stylesheet" href="/js/prettify/prettify.css" />
<style type="text/css">
    body { background:#e8e8e8; }
    @media screen and (max-width: 750px){
        body { background:#fff; }
    }
    @media screen and (max-width: 1020px){
        body { background:#fff; }
    }
</style>

<div id="content">
    <div class="entry">
        <h1 class="entry-title"><a href="/mysql-charset-and-table-name-lower-case" title="MySQL字符编码和大小写敏感问题">MySQL字符编码和大小写敏感问题</a></h1>
        <p class="entry-date">2014-10-16</p>
        <h2 id="section">背景</h2>

<p>关于MySQL，遇到几个问题，列一下：</p>

<ul>
  <li>乱码问题：字符集不统一；</li>
  <li>无法启动：查看错误日志；</li>
  <li>无法删除database：先在数据存储目录清理；</li>
  <li>table找不到：table区分大小写；</li>
</ul>

<p>MySQL版本：</p>

<pre><code>[devp@localhost ~]$ mysql -V
mysql  Ver 14.14 Distrib 5.6.20, for Linux (x86_64) using  EditLine wrapper
</code></pre>

<h2 id="section-1">乱码问题</h2>

<p>看官网，mysql的refman（reference manual，参考手册）中，<code>globalization</code> –&gt; <code>character set configuration</code>，其中提到：
system、server、client的charset不一致时，会产生乱码。</p>

<p>通过如下命令查看一下，当前mysql各个组件的字符集详情：</p>

<pre><code>mysql&gt; show variables like "character%";
+--------------------------+----------------------------+
| Variable_name            | Value                      |
+--------------------------+----------------------------+
| character_set_client     | utf8                       |
| character_set_connection | utf8                       |
| character_set_database   | latin1                     |
| character_set_filesystem | binary                     |
| character_set_results    | utf8                       |
| character_set_server     | latin1                     |
| character_set_system     | utf8                       |
| character_sets_dir       | /usr/share/mysql/charsets/ |
+--------------------------+----------------------------+
8 rows in set (0.00 sec)
</code></pre>

<p>通过命令：show collation，查看当前MySQL支持的字符集。从上面查询结果可知，server的字符集与system、client不同，则，在my.cnf文件中<code>[mysqld]</code>下，设定server的字符集即可。</p>

<pre><code># /usr/my.cnf
[mysqld]
character_set_server=utf8
</code></pre>

<p><strong>特别说明</strong>：如果client的编码格式不为utf8，则，需要在<code>my.cnf</code>文件中添加如下配置（参考<a href="http://dev.mysql.com/doc/refman/5.6/en/charset-connection.html">charset connection</a>）：</p>

<pre><code># /usr/my.cnf
[mysql]
default-character-set=utf8
</code></pre>

<p>重新启动MySQL，OK（根据<a href="http://dev.mysql.com/doc/refman/5.6/en/server-system-variables.html#sysvar_character_set_server">官网解释</a>， 不需要向数据库重新插入数据）。database的编码方式，不要手动调整，其始终与default database保持一致，若没有default database，则由server的编码方式决定。</p>

<p><strong>补充</strong>：在windows环境下，与Linux有几点差异：</p>

<ul>
  <li>没有<code>my.cnf</code>文件，此时修改<code>my.ini</code>文件，即可完成环境变量的配置；</li>
  <li>通常情况下，如果没有找到<code>my.ini</code>文件，则将<code>my-default.ini</code>文件复制之后重命名为<code>my.ini</code>文件；</li>
</ul>

<h2 id="section-2">无法启动</h2>

<p>通过<code>service mysql start</code>，无法启动MySQL，提示出错，略焦躁，不要着急，有错误日志，查看即可。错误日志位置：/var/lib/mysql/*.err，出错信息：</p>

<pre><code>[ERROR] /usr/sbin/mysqld: unknown variable 'default-character-set=utf-8'
</code></pre>

<p>原来是在my.cnf文件中添加了一个变量，MySQL无法识别，从my.cnf删除即可。官方文档中<a href="http://dev.mysql.com/doc/refman/5.6/en/server-administration.html">MySQL Server Administration</a>，有查看错误日志的详细信息，另外，错误日志位置参考<a href="http://dev.mysql.com/doc/refman/5.6/en/installing.html">Installing and Upgrading MySQL</a>中提到的安装目录结构。</p>

<h2 id="database">无法删除Database</h2>

<p>删除database时，出错：</p>

<pre><code>mysql&gt; drop database test;
ERROR 1010 (HY000): Error dropping database (can't rmdir './test', errno: 39)
</code></pre>

<p><strong>解决办法</strong>：</p>

<ul>
  <li>无法删除数据库或者表格，通常是由于有client还在访问数据库中的某张表，导致无法删除，通常重启mysql服务后再去删除即可，具体命令<code>mysql service restart</code>；</li>
  <li>如果重启MySQL服务后，仍然无法删除，则，停掉MySQL服务，然后，到MySQL存放数据的路径下（/var/lib/mysql/），将test数据库对应目录（./test）下内容清空，再删除test数据库即可；</li>
</ul>

<h2 id="table">找不到table</h2>

<p>MySQL无法连接，提示表格不存在，设置table名称不区分大小写：</p>

<ol>
  <li>用ROOT登录，修改<code>my.cnf</code></li>
  <li>在<code>[mysqld]</code>下加入一行：<code>lower_case_table_names=1</code></li>
  <li>重新启动数据库即可;</li>
</ol>

<p><strong>思考</strong>：字段是否区分大小写？数据库还有其他大小写敏感的地方吗？</p>

<h2 id="section-3">参考来源</h2>

<ul>
  <li><a href="http://dev.mysql.com/doc/">MySQL官方文档</a></li>
  <li><a href="http://dev.mysql.com/doc/refman/5.6/en/installing.html">Installing and Upgrading MySQL</a></li>
  <li><a href="http://dev.mysql.com/doc/refman/5.6/en/server-administration.html">MySQL Server Administration</a></li>
  <li><a href="http://coderbee.net/index.php/db/20140112/709">MySQL 乱码 与 字符集</a></li>
</ul>



        <div id="disqus_container">
            <div style="margin-bottom:20px" class="right">
				<wb:share-button appkey="2306590132" addition="simple" type="button" ralateUid="2356527183"></wb:share-button>
            </div>
            <!--<a href="#" class="comment" onclick="return false;">点击查看评论</a>-->
            <div id="disqus_thread"></div>
        </div>
    </div>

	
    <div class="sidenav">
		<iframe width="100%" height="75" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=550&fansRow=2&ptype=1&speed=0&skin=1&isTitle=0&noborder=0&isWeibo=0&isFans=0&uid=2356527183&verifier=1ccfb61e&colors=d6f3f7,ffffff,666666,0082cb,ecfbfd&dpc=1"></iframe>
    </div>

</div>

<script src="/js/post.js" type="text/javascript"></script>


	<div id="gotoTop">Top</div>


    <!--*********************************************************-->
    <!--****** 宝贝儿，看见这个时候，删掉下面的统计代码哦~ ******-->
    <!--*********************************************************-->
	<script>
	  (function(i,s,o,g,r,a,m){
		  i['GoogleAnalyticsObject']=r;i[r]=i[r] || function(){
			(i[r].q=i[r].q||[]).push(arguments)}, i[r].l=1*new Date();
			a=s.createElement(o), m=s.getElementsByTagName(o)[0];
			a.async=1;
			a.src=g;
			m.parentNode.insertBefore(a,m)
	  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	  ga('create', 'UA-48535193-1', 'ningg.github.io');
	  ga('send', 'pageview');
	</script>
    
	
    <script type="text/javascript">
		function gotoTop(min_height){
			$("#gotoTop").click(
				function(){$('html,body').animate({scrollTop:0},700);
			}).hover(
				function(){$(this).addClass("hover");},
				function(){$(this).removeClass("hover");
			});
			min_height ? min_height = min_height : min_height = 600;
			$(window).scroll(function(){
				
				var s = $(window).scrollTop();
				
				if( s > min_height){
					$("#gotoTop").fadeIn(100);
				}else{
					$("#gotoTop").fadeOut(200);
				};
			});
		};
		gotoTop();

        $(function(){
            $('.home-follow').click(function(e){
                e.preventDefault();

                if($('.home-contact').is(':visible')){
                    $('.home-contact').slideUp(100);
                }else{
                    $('.home-contact').slideDown(100);
                }
            });
        })

    </script>
</body>
</html>
