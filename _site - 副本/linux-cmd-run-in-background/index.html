<!DOCTYPE html>
<html xmlns:wb="http://open.weibo.com/wb">
<head>
    <!--   Author: NingG   -->
    <meta charset="utf-8" />
	<meta property="wb:webmaster" content="7ea7f3d5f3edad6a" />
    <title>Linux 后台运行命令 | ningg.top</title>
    <meta name="author" content="NingG" />
    <meta name="renderer" content="webkit">
    <meta name="description" content=" SSH远程操作linux服务器：SSH连接中断，导致当前运行的命令也终止  " />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">

    <link rel="stylesheet" href="/css/default.css" type="text/css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="alternate" type="application/atom+xml" title="Recent Entries" href="" />
	
    <script src="/js/jquery-1.7.1.min.js" type="text/javascript"></script>
	<script src="http://tjs.sjs.sinajs.cn/open/api/js/wb.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</head>
<body>
	
    <div class="home-menu">
        <div class="home-icon-con">
            <a class="home-menu-icon" href="/">NingG</a>
            <a class="home-follow" href="#" title="Contact Me">+</a>
        </div>
        <div class="home-contact">
            <a href="http://weibo.com/ggningg/" target="_blank" style="margin-left:-5px;"><img src="http://www.weibo.com/favicon.ico" alt="" width="25"/></a>
            <a href="http://www.douban.com/people/ggningg/" target="_blank" style="text-align:center;"><img src="http://www.douban.com/favicon.ico" alt="" width="22"/></a>
			<a href="http://github.com/ningg" alt="" target="_blank" style="text-align:right;"><img src="/images/icon-cube-smaller.png" width="22"/></a>
        </div>
    </div>

    <link rel="stylesheet" href="/js/prettify/prettify.css" />
<style type="text/css">
    body { background:#e8e8e8; }
    @media screen and (max-width: 750px){
        body { background:#fff; }
    }
    @media screen and (max-width: 1020px){
        body { background:#fff; }
    }
</style>

<div id="content">
    <div class="entry">
        <h1 class="entry-title"><a href="/linux-cmd-run-in-background" title="Linux 后台运行命令">Linux 后台运行命令</a></h1>
        <p class="entry-date">2013-01-17</p>
        <h2 id="section">问题背景</h2>

<p>使用<code>SecureCRT</code>/<code>putty</code>等客户端，远程连接Linux服务器，并且执行脚本时，由于网络不稳定，有可能导致连接中断，在这种情况下，我担心会影响脚本程序的正常执行（不能肯定是否一定会影响）；因此希望启动一个脚本，让其在后台一直运行，不会随着<code>连接中断</code>而终止掉。</p>

<p><strong>外加问题</strong>：现在一个命令的输出信息过多，希望后台运行时，不保存输出信息。</p>

<h2 id="section-1">解决办法</h2>

<h3 id="section-2">简要说明</h3>
<p>先说最终的解决办法：</p>

<pre><code>nohup sh collectCloSpan.sh &amp;
</code></pre>

<p>简要说明：</p>

<ol>
  <li><code>&amp;</code>：表示进程<code>sh collectCloSpan.sh</code>在后台运行；</li>
  <li><code>nohup</code>：表示，如果当前连接到服务器的终端关闭，进程<code>sh collectCloSpan.sh</code>;</li>
  <li>进程<code>sh collectCloSpan.sh</code>的输出信息，保存在当前路径的<code>nohup.out</code>文件中。（如果当前路径不允许新建文件，则，输出信息保存在<code>~/nohup.out</code>文件中）</li>
</ol>

<p>好了，现在怎么解决<code>nohup.out</code>文件过大的问题呢？</p>

<h3 id="section-3">输出文件过大</h3>

<p>经过查询有2个解决思路：</p>

<ol>
  <li>完全删除输出信息：一点输出信息都不想要；</li>
  <li>删除过时的输出信息，只保留最近一段时间的输出信息。</li>
</ol>

<p>完全删除输出信息：在程序后台运行之后，直接删除文件nohup.out文件即可，除非重新运行程序，否则，不会再有<code>nohup.out</code>文件；</p>

<p>删除过时的输出信息（在线清空文件内容）：</p>

<pre><code>/*执行效率较高*/
cp /dev/null nohup.out
</code></pre>

<p>或者</p>

<pre><code>/*文件很大时，执行较慢*/
cat /dev/null &gt; nohup.out
</code></pre>

<p>关于<code>/dev/null</code>到底是什么，自己<code>google</code>或者<code>baidu</code>吧。</p>

<p>感兴趣的可以具体看下面的详细说明。<em>（不感兴趣的可以直接跳过了）。</em></p>

<h2 id="section-4">效果验证 &amp; 细节分析</h2>

<p>后台运行脚本（<a href="https://www.ibm.com/developerworks/cn/linux/l-cn-nohup/">参考1</a>）：</p>

<pre><code>nohup ping www.baidu.com &amp;
</code></pre>

<p>然后等待，出现如下结果：</p>

<p><img src="/images/linux-cmd-run-in-background/linux-cmd-run-in-background.jpg" alt="LINUX后台运行命令nohup测试" /></p>

<p>输入命令<code>jobs</code>可以查看现有的后台程序，如上图；并且可以使用<code>fg 1</code>命令，将第一个后台程序，调入前台。</p>

<p>在<code>shell</code>环境下，使用<code>exit</code>命令退出；如上图所示。<em>（启动进程<code>nohup ping www.baidu.com &amp;</code>后，如果没有返回到<code>shell</code>环境，则直接敲<code>回车(Enter)</code>即可）</em></p>

<p>再次使用<code>SecureCRT</code>/<code>putty</code>等终端登录，并输入如下命令：</p>

<pre><code>ps –ef | grep “ping”
</code></pre>

<p>可以看到上图中结果，原来的进程<code>pid</code>为<code>13380</code>还在执行，只是此进程的<code>父进程</code>变为<code>pid=1</code>的特殊进程。</p>

<p><strong>总结</strong>：后台运行：<code>command &amp;</code>和 <code>nohup command &amp;</code>有区别吗？</p>

<p>答：</p>

<ol>
  <li><code>command &amp;</code>：后台运行，关掉中断，命令会终止运行；</li>
  <li><code>nobup command &amp;</code>：后台运行，关掉终端，命令会继续运行；</li>
</ol>

<h2 id="section-5">进程的挂起与运行</h2>

<p>通常挂起、执行进程的基本步骤：</p>

<ol>
  <li><code>ctrl + z</code>：挂起当前执行的前台进程；<em>（命令挂起，并没有在后台执行）</em></li>
  <li><code>jobs</code>：查询被挂起的进程；</li>
  <li><code>fg jobsNo</code>：继续执行被挂起的进程；<em>（<code>jobsNo</code>：使用<code>jobs</code>查询获取的进程编号）</em></li>
</ol>

<p>下面对几个命令，简要介绍一下：</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">命令</th>
      <th style="text-align: left">说明</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><code>ctrl + z</code></td>
      <td style="text-align: left">挂起进程</td>
    </tr>
    <tr>
      <td style="text-align: left"><code>ctrl + c</code></td>
      <td style="text-align: left">终止进程</td>
    </tr>
    <tr>
      <td style="text-align: left"><code>jobs</code></td>
      <td style="text-align: left">list the <code>active jobs</code> (both <code>running jobs</code> and <code>stopped jobs</code>).</td>
    </tr>
    <tr>
      <td style="text-align: left"><code>fg [jobspec]</code></td>
      <td style="text-align: left">在foreground继续执行进程</td>
    </tr>
    <tr>
      <td style="text-align: left"><code>bg [jobspec ...]</code></td>
      <td style="text-align: left">在background继续执行进程。<em>（此时，无法使用<code>ctrl + z</code>和<code>ctrl + c</code>来操作进程）</em></td>
    </tr>
  </tbody>
</table>

<p><strong>思考</strong>：进程的<code>active</code>,<code>running</code>,<code>stopped</code>,<code>suspended</code>几种状态是什么？他们之间有什么关系？</p>

<h2 id="section-6">参考来源</h2>

<ol>
  <li><a href="https://www.ibm.com/developerworks/cn/linux/l-cn-nohup/">https://www.ibm.com/developerworks/cn/linux/l-cn-nohup/</a></li>
  <li><a href="http://www.linuxidc.com/Linux/2010-09/28366.htm">http://www.linuxidc.com/Linux/2010-09/28366.htm</a></li>
  <li><a href="http://www.cnblogs.com/lwm-1988/archive/2011/08/20/2147299.html">http://www.cnblogs.com/lwm-1988/archive/2011/08/20/2147299.html</a></li>
</ol>



        <div id="disqus_container">
            <div style="margin-bottom:20px" class="right">
				<wb:share-button appkey="2306590132" addition="simple" type="button" ralateUid="2356527183"></wb:share-button>
            </div>
            <!--<a href="#" class="comment" onclick="return false;">点击查看评论</a>-->
            <div id="disqus_thread"></div>
        </div>
    </div>

	
    <div class="sidenav">
		<iframe width="100%" height="75" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=550&fansRow=2&ptype=1&speed=0&skin=1&isTitle=0&noborder=0&isWeibo=0&isFans=0&uid=2356527183&verifier=1ccfb61e&colors=d6f3f7,ffffff,666666,0082cb,ecfbfd&dpc=1"></iframe>
    </div>

</div>

<script src="/js/post.js" type="text/javascript"></script>


	<div id="gotoTop">Top</div>


    <!--*********************************************************-->
    <!--****** 宝贝儿，看见这个时候，删掉下面的统计代码哦~ ******-->
    <!--*********************************************************-->
	<script>
	  (function(i,s,o,g,r,a,m){
		  i['GoogleAnalyticsObject']=r;i[r]=i[r] || function(){
			(i[r].q=i[r].q||[]).push(arguments)}, i[r].l=1*new Date();
			a=s.createElement(o), m=s.getElementsByTagName(o)[0];
			a.async=1;
			a.src=g;
			m.parentNode.insertBefore(a,m)
	  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	  ga('create', 'UA-48535193-1', 'ningg.github.io');
	  ga('send', 'pageview');
	</script>
    
	
    <script type="text/javascript">
		function gotoTop(min_height){
			$("#gotoTop").click(
				function(){$('html,body').animate({scrollTop:0},700);
			}).hover(
				function(){$(this).addClass("hover");},
				function(){$(this).removeClass("hover");
			});
			min_height ? min_height = min_height : min_height = 600;
			$(window).scroll(function(){
				
				var s = $(window).scrollTop();
				
				if( s > min_height){
					$("#gotoTop").fadeIn(100);
				}else{
					$("#gotoTop").fadeOut(200);
				};
			});
		};
		gotoTop();

        $(function(){
            $('.home-follow').click(function(e){
                e.preventDefault();

                if($('.home-contact').is(':visible')){
                    $('.home-contact').slideUp(100);
                }else{
                    $('.home-contact').slideDown(100);
                }
            });
        })

    </script>
</body>
</html>
