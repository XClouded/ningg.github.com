<!DOCTYPE html>
<html xmlns:wb="http://open.weibo.com/wb">
<head>
    <!--   Author: NingG   -->
    <meta charset="utf-8" />
	<meta property="wb:webmaster" content="7ea7f3d5f3edad6a" />
    <title>正则表达式（字符串匹配模式） | ningg.top</title>
    <meta name="author" content="NingG" />
    <meta name="renderer" content="webkit">
    <meta name="description" content=" 正则表达式，以简单、高效的方式，实现字符串的复杂匹配操作  " />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">

    <link rel="stylesheet" href="/css/default.css" type="text/css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="alternate" type="application/atom+xml" title="Recent Entries" href="" />
	
    <script src="/js/jquery-1.7.1.min.js" type="text/javascript"></script>
	<script src="http://tjs.sjs.sinajs.cn/open/api/js/wb.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</head>
<body>
	
    <div class="home-menu">
        <div class="home-icon-con">
            <a class="home-menu-icon" href="/">NingG</a>
            <a class="home-follow" href="#" title="Contact Me">+</a>
        </div>
        <div class="home-contact">
            <a href="http://weibo.com/ggningg/" target="_blank" style="margin-left:-5px;"><img src="http://www.weibo.com/favicon.ico" alt="" width="25"/></a>
            <a href="http://www.douban.com/people/ggningg/" target="_blank" style="text-align:center;"><img src="http://www.douban.com/favicon.ico" alt="" width="22"/></a>
			<a href="http://github.com/ningg" alt="" target="_blank" style="text-align:right;"><img src="/images/icon-cube-smaller.png" width="22"/></a>
        </div>
    </div>

    <link rel="stylesheet" href="/js/prettify/prettify.css" />
<style type="text/css">
    body { background:#e8e8e8; }
    @media screen and (max-width: 750px){
        body { background:#fff; }
    }
    @media screen and (max-width: 1020px){
        body { background:#fff; }
    }
</style>

<div id="content">
    <div class="entry">
        <h1 class="entry-title"><a href="/regular-expression" title="正则表达式（字符串匹配模式）">正则表达式（字符串匹配模式）</a></h1>
        <p class="entry-date">2014-05-04</p>
        <h2 id="section">背景</h2>

<p>最近师兄安排我用Pig解析一下日志文件，在数据装载过程中，需要抽取特定位置的字符串<em>（即使是数字、符号，在程序看来也是字符）。</em></p>

<p>回想起之前的团队中，CZW对正则表达式进行过技术分享，深入浅出，反正当时我是听懂了，应该也达到了能用的水平，无奈10月左右的时间，只剩下点滴印象了，<em>（唉，时光已去，曾经掌握的东西，当要用时，又需要重新去学，这正是自己写技术博客的原因之一）</em></p>

<p>不多说了，接下来，将整体上对正则表达式来一个梳理。</p>

<h2 id="section-1">正则表达式，是什么？</h2>

<p>正则表达式，英文原名: <code>Regular Expression</code>（简称：<code>regex</code>或<code>regexp</code>），直接翻译：<code>有规律的式子</code>，或者，可以翻译为<code>描述规律的式子</code>。<em>(他奶奶的，不知道谁第一个翻译的，取名<code>正则表达式</code>？忒高大上了，听上去完全不知到干什么的，还是<code>描述规律的式子</code>容易理解)</em></p>

<p><img src="/images/regular-expression/regular-expressions-comics.png" alt="comics" /></p>

<h3 id="section-2">解决什么问题？</h3>

<p>通俗的说：查找满足一定规则的字符串。</p>

<p>可用于文本的查找、替换。</p>

<h3 id="section-3">应用场景举例</h3>

<ul>
  <li>场景1：仅查找出文本中单词<code>car</code>，不想找出其他单词<code>scar</code>、<code>carry</code>等。</li>
  <li>场景2：用户在注册页面填写Email时，检查Email地址格式是否正确。</li>
  <li>场景3：查找指定目录下，文件名中包含<code>application</code>字样的文件。</li>
</ul>

<h3 id="section-4">正式定义</h3>

<p>正则表达式，给个正式定义：按一定规则查找字符串，并可以进行替换操作。</p>

<p>正则表达式，几点要注意的内容：</p>

<ul>
  <li>有自己的语法规则，即，正则表达式语言；</li>
  <li>不是正规的（完备的）程序设计语言，没有专门针对正则表达式的软件，来安装和运行；</li>
  <li>常内置于其他软件/语言中；（即，其他语言实现了正则表达式规则的解析器）</li>
</ul>

<p>当前，java/Python/PHP/JavaScript等，都支持正则表达式。</p>

<p>支持正则表达式的语言\工具：<a href="http://www.regular-expressions.info/tools.html">Applications and Languages Related with RegEx</a></p>

<h3 id="section-5">产生的启发点</h3>

<p>1950年左右时，数学领域的一些研究工作</p>

<blockquote>
  <p><a href="http://cns-classes.bu.edu/cn550/Readings/mcculloch-pitts-43.pdf">A logical calculus of the ideas immanent in nervous activity</a>, 1943;
Author: McCulloch, Warren S., and Walter Pitts;
简述：神经系统中神经元看作小巧而简单的自动控制单元。</p>
</blockquote>

<blockquote>
  <p><a href="http://www.dlsi.ua.es/~mlf/nnafmc/papers/kleene56representation.pdf">Representation of Events in Nerve Nets and Finite Automata</a>, 1956;
Author: Kleene, Stephen C;
简述：“正则集合”的数学符号来描述此模型。</p>
</blockquote>

<p>几年后，计算机领域借助上述研究成果，实现perl、grep等工具/语言，正则表达式进入实用阶段。</p>

<p><img src="/images/regular-expression/regular-expression-introduction.png" alt="illustration" /></p>

<p><strong>校正</strong>：上面图片<code>Illustration of Regular Expression</code>中，<code>Meet c</code>应该修正为<code>Meet b</code>。</p>

<h2 id="section-6">怎么用？</h2>

<p>正则表达式，俗称<code>描述规律的式子</code>，用来查找字符串，基本逻辑是：</p>

<ul>
  <li>如何匹配出1个字符；</li>
  <li>如何匹配出n个字符；</li>
  <li>如何匹配出特定位置的字符；（特定位置：字符串的开头、结尾）</li>
</ul>

<h3 id="section-7">匹配1个字符</h3>

<table>
  <thead>
    <tr>
      <th style="text-align: left">字符</th>
      <th style="text-align: left">含义</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">a</td>
      <td style="text-align: left">一个字符<code>a</code></td>
    </tr>
    <tr>
      <td style="text-align: left">[abc]</td>
      <td style="text-align: left">[..]表示集合内的任意一个字符，在此例中，[abc]表示a、b、c字符中的任意一个</td>
    </tr>
    <tr>
      <td style="text-align: left">[^abc]</td>
      <td style="text-align: left">除去a、b、c之外的任意一个字符，注意，<code>^</code>只限于在<code>[^</code>位置，才表示此含义</td>
    </tr>
    <tr>
      <td style="text-align: left">[0123456789]</td>
      <td style="text-align: left">任意一个数字</td>
    </tr>
    <tr>
      <td style="text-align: left">[a-z]</td>
      <td style="text-align: left">任意一个消息字母（在[]内<code>-</code>为特殊字符，代表区间）</td>
    </tr>
    <tr>
      <td style="text-align: left">[0-9]</td>
      <td style="text-align: left">任意一个数字，等同于[0123456789]</td>
    </tr>
    <tr>
      <td style="text-align: left">.</td>
      <td style="text-align: left">任意一个字符</td>
    </tr>
    <tr>
      <td style="text-align: left">\f</td>
      <td style="text-align: left">换页符</td>
    </tr>
    <tr>
      <td style="text-align: left">\t</td>
      <td style="text-align: left">制表键，tab</td>
    </tr>
    <tr>
      <td style="text-align: left">\r</td>
      <td style="text-align: left">回车符，return</td>
    </tr>
    <tr>
      <td style="text-align: left">\n</td>
      <td style="text-align: left">换行符，nextLine</td>
    </tr>
    <tr>
      <td style="text-align: left">\v</td>
      <td style="text-align: left">垂直制表符</td>
    </tr>
    <tr>
      <td style="text-align: left">\w</td>
      <td style="text-align: left">等价于[a-zA-Z0-9]，任何一个字母（区分大小写）、数字、下划线</td>
    </tr>
    <tr>
      <td style="text-align: left">\W</td>
      <td style="text-align: left">等价于[^a-zA-Z0-9]，任何一个非字母（区分大小写）、数字、下划线</td>
    </tr>
    <tr>
      <td style="text-align: left">\d</td>
      <td style="text-align: left">任何一个数字字符,等价于[0-9]</td>
    </tr>
    <tr>
      <td style="text-align: left">\D</td>
      <td style="text-align: left">等价于[^0-9]，任何一个非数字字符</td>
    </tr>
    <tr>
      <td style="text-align: left">\s</td>
      <td style="text-align: left">等价于[ \f\n\r\t\v]，任何一个空白字符</td>
    </tr>
    <tr>
      <td style="text-align: left">\S</td>
      <td style="text-align: left">等价于[^ \f\n\r\t\v]，任何一个非空白字符</td>
    </tr>
    <tr>
      <td style="text-align: left">\x0A</td>
      <td style="text-align: left">（16进制）对应ASCII字符10，即\n</td>
    </tr>
    <tr>
      <td style="text-align: left">\011</td>
      <td style="text-align: left">（8进制）对应ASCII字符9，即\t</td>
    </tr>
  </tbody>
</table>

<p><strong>校正</strong>：关于<code>\s</code>,《<a href="http://book.douban.com/subject/2269648/" title="《正则表达式必知必会》2007年12月，第1版">正则表达式必知必会</a>》 版本信息（2007年12月，第1版），在Page 31中，<code>\s</code>表示任何一个空白字符，应该包含空格<code> </code>在内（具体参考：<a href="http://www.regular-expressions.info/shorthand.html">Shorthand Character Classes Of Regex</a>）</p>

<h3 id="n">匹配n个字符</h3>

<p>匹配<code>n</code>个字符，就是“匹配一个字符”重复<code>n</code>次，嗯，很简单，则有：<code>aa</code>，表示匹配连续两个字符<code>a</code>；<code>\d\d</code>,表示匹配2个数字；<code>\n\n\n</code>,表示匹配3个换行符。<em>(很简单有木有)</em></p>

<p>问题来了，假设有如下文本：</p>

<blockquote>
  <p>I $am$ the $god$.</p>
</blockquote>

<p>目标：查找出<code>$..$</code>间的内容，正则表达式怎么写？(<code>$..$</code>间字符的个数，不能确定，只知道1个以上)</p>

<p>我x，不是说要“匹配一个字符”重复<code>n</code>次就可以么？关键现在<code>n</code>是几啊？这怎么还是一个范围（<code>n&gt;=1</code>）？这如何是好？</p>

<p>莫急莫急，请往下看。</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">字符</th>
      <th style="text-align: left">含义</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">?</td>
      <td style="text-align: left">0次或1次</td>
    </tr>
    <tr>
      <td style="text-align: left">+</td>
      <td style="text-align: left">1次以上（a+：表示一个或多个a的连续出现；[0-9]+：表示一个或多个连续出现的数字）</td>
    </tr>
    <tr>
      <td style="text-align: left">*</td>
      <td style="text-align: left">0次及0次以上</td>
    </tr>
    <tr>
      <td style="text-align: left">{3}</td>
      <td style="text-align: left">3次</td>
    </tr>
    <tr>
      <td style="text-align: left">{ ,3}</td>
      <td style="text-align: left">0次–3次（包含0次和3次）</td>
    </tr>
    <tr>
      <td style="text-align: left">{1, }</td>
      <td style="text-align: left">1次以上</td>
    </tr>
    <tr>
      <td style="text-align: left">{1,3}</td>
      <td style="text-align: left">1次–3次（包含1次和3次）</td>
    </tr>
  </tbody>
</table>

<p>到这儿，就可以看出，使用 <code>$.+$</code>就能匹配上面的内容了。</p>

<h3 id="section-8">匹配特定位置字符</h3>

<table>
  <thead>
    <tr>
      <th style="text-align: left">字符</th>
      <th style="text-align: left">含义</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">^</td>
      <td style="text-align: left">在字符串开头</td>
    </tr>
    <tr>
      <td style="text-align: left">$</td>
      <td style="text-align: left">在字符串结尾</td>
    </tr>
    <tr>
      <td style="text-align: left">\b</td>
      <td style="text-align: left">单词的边界</td>
    </tr>
    <tr>
      <td style="text-align: left">\B</td>
      <td style="text-align: left">非单词的边界</td>
    </tr>
  </tbody>
</table>

<p>匹配出如下文本中的cat单词：</p>

<blockquote>
  <p>cat catt</p>
</blockquote>

<p>正则表达式：<code>\bcat\b</code></p>

<p>匹配如下文本中的<code>-</code>，要求：只找出两个字母之间的<code>-</code>，文本内容：</p>

<blockquote>
  <p>A-b - ss s- f-  - a-</p>
</blockquote>

<p>正则表达式：<code>\B-\B</code></p>

<h3 id="section-9">过度匹配（贪婪）</h3>

<p>要匹配文本</p>

<blockquote>
  <p>ben@cib.com.cn</p>
</blockquote>

<p>正则表达式：<code>\w+@\w[\w\.]+\.\w+</code></p>

<p>理论上，可以匹配出：</p>

<ol>
  <li><code>ben@baidu.com</code></li>
  <li><code>ben@baidu.com.cn</code></li>
</ol>

<p>但是，上述匹配结果是2，即<code>ben@cib.com.cn</code>。原因：<code>+</code>、<code>*</code>默认都是贪婪匹配，即找出最长的匹配模式；如果希望匹配出结果1，即<code>ben@cib.com</code>，惰性匹配，找出最短的匹配模式，需要修改正则表达式：<code>\w+?@\w[\w\.]+?\.\w+?</code>，即<code>+</code>替换为<code>+?</code>，<code>*</code>替换为<code>*?</code>。</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">贪婪匹配</th>
      <th style="text-align: left">懒惰字符</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">*</td>
      <td style="text-align: left">*?</td>
    </tr>
    <tr>
      <td style="text-align: left">+</td>
      <td style="text-align: left">+?</td>
    </tr>
    <tr>
      <td style="text-align: left">{n, }</td>
      <td style="text-align: left">{n, }?</td>
    </tr>
  </tbody>
</table>

<h3 id="section-10">补充说明</h3>

<table>
  <thead>
    <tr>
      <th style="text-align: left">字符</th>
      <th style="text-align: left">含义</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">\</td>
      <td style="text-align: left">转义字符，例如，<code>\.</code> 表示<code>.</code>字符本身，单独<code>.</code>表示匹配任意一个字符；<code>\?</code>表示<code>?</code>字符自身</td>
    </tr>
    <tr>
      <td style="text-align: left"><code>|</code></td>
      <td style="text-align: left">表示其前后两种模式的任意一个，例如<code>(19|20)\d{2}</code>，匹配19xx和20xx，xx表示任意两位数字</td>
    </tr>
    <tr>
      <td style="text-align: left">()</td>
      <td style="text-align: left">子表达式，整体上看作一个独立元素</td>
    </tr>
  </tbody>
</table>

<p>假设有一个文本</p>

<blockquote>
  <p>Hello, my name is Ben<code>&amp;nbsp;</code> … Node.js, Linux<code>&amp;nbsp;&amp;nbsp;</code>, and other tech.</p>
</blockquote>

<p>现在要匹配出连续的两个<code>&amp;nbsp;</code>，可以使用<code>&amp;nbsp;&amp;nbsp;</code>，也可以使用<code>(&amp;nbsp;){2}</code>，而不能使用<code>&amp;nbsp;{2}</code>，因为<code>{2}</code>，表示匹配其前面字符，实际<code>&amp;nbsp;{2}</code>等价与<code>&amp;nbsp;;</code>。</p>

<p>匹配IP：10.108.210.111</p>

<p>正则表达式：<code>\d{1,3}\. \d{1,3}\. \d{1,3}\. \d{1,3}\ </code></p>

<p>可以替换为： <code>(\d{1,3}\.){3}\d{1,3}\ </code></p>

<h2 id="section-11">高级用法</h2>

<h3 id="section-12">子表达式</h3>

<p>前文提到过，在这儿单独拿出来说，是因为下文要用到。<em>（尼玛，下文难道不会用到前文其他内容么？凭什么单说<code>子表达式</code>啊；因为，实在是怕你忘了，其他内容你即使忘了，也容易自己查找）</em></p>

<h3 id="section-13">引用回溯</h3>

<p>本质：前后匹配一致；</p>

<p>技术上实质：后半部分引用前半部分匹配到的子表达式。</p>

<p>举例：</p>

<p>匹配如下文档中重复输入的单次：</p>

<blockquote>
  <p>This is a block of of text, several words here are are repeated, and and they should not be.</p>
</blockquote>

<p>正则表达式：<code>[ ]+(\w+)[ ]+\1</code></p>

<p><code>\1</code>表示<code>(\w+)</code>中匹配到的内容。</p>

<p><strong>注意</strong>：回溯引用中<code>\1</code>,<code>\2</code>只能一用子表达式（即用<code>()</code>括起来的部分），<code>\0</code>代表整个正则表达式匹配的结果。</p>

<h3 id="section-14">前后查找</h3>

<p>本质：匹配全部，返回局部；</p>

<p>技术上实质：将子表达式向前（后）匹配到字符串返回。</p>

<ul>
  <li>向前查找： 正 向前查找<code>exp2(?=exp1)</code>， 负 向前查找<code>(exp2(?!exp1))</code>；</li>
  <li>向后查找： 正 向后查找<code>(?&lt;=exp1)exp2</code>， 负 向后查找<code>(?&lt;!exp1)exp2</code>；</li>
</ul>

<p>注：上式都是匹配<code>exp1</code>，返回<code>exp2</code>。</p>

<p>举例1：</p>

<p>匹配如下文本中的传输协议</p>

<blockquote>
  <p>http://www.baidu.com</p>

  <p>ftp://ftp.baidu.com</p>

  <p>https://mails.baidu.com</p>
</blockquote>

<p>正则表达式：<code>.+(?=:)</code></p>

<p>举例2：</p>

<p>匹配如下文本中的金额</p>

<blockquote>
  <p>abc: $23.01</p>

  <p>hdc: $899.00</p>
</blockquote>

<p>正则表达式：<code>(?&lt;=\$)\d[\d.]*\d</code></p>

<h3 id="section-15">嵌入条件</h3>

<p>可以添加逻辑条件，类似if。</p>

<p>说几点：</p>

<ul>
  <li>功能很强大；</li>
  <li>使用的不是很多；</li>
  <li>真要了解一下，参考《<a href="http://book.douban.com/subject/2269648/" title="《正则表达式必知必会》2007年12月，第1版">正则表达式必知必会</a>》</li>
</ul>

<h3 id="section-16">元字符？</h3>

<p>啥？元字符？什么东东？小伙儿，不要激动。正则表达式为了描述匹配哪些位置的字符串，使用了<code>.</code>,<code>\d</code>,<code>\s</code>,<code>\w</code>,<code>\W</code>,<code>^</code>,<code>[]</code>,<code>()</code>,<code>|</code>,<code>$</code>，来描述正则表达式语言的语法，即，这些字符是表述<code>正则表达式语言</code>语法规则的字符，成为这个语言的元字符。</p>

<h2 id="section-17">参考来源</h2>

<ul>
  <li><a href="http://book.douban.com/subject/2269648/" title="《正则表达式必知必会》2007年12月，第1版">正则表达式必知必会</a></li>
  <li><a href="http://www.regular-expressions.info/tutorial.html">Regex Tutorial</a></li>
</ul>

<h2 id="section-18">休息一下</h2>

<p>你能读懂下面这张图片吗？</p>

<p><img src="/images/regular-expression/regex-example.png" alt="regex-example" /></p>



        <div id="disqus_container">
            <div style="margin-bottom:20px" class="right">
				<wb:share-button appkey="2306590132" addition="simple" type="button" ralateUid="2356527183"></wb:share-button>
            </div>
            <!--<a href="#" class="comment" onclick="return false;">点击查看评论</a>-->
            <div id="disqus_thread"></div>
        </div>
    </div>

	
    <div class="sidenav">
		<iframe width="100%" height="75" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=550&fansRow=2&ptype=1&speed=0&skin=1&isTitle=0&noborder=0&isWeibo=0&isFans=0&uid=2356527183&verifier=1ccfb61e&colors=d6f3f7,ffffff,666666,0082cb,ecfbfd&dpc=1"></iframe>
    </div>

</div>

<script src="/js/post.js" type="text/javascript"></script>


	<div id="gotoTop">Top</div>


    <!--*********************************************************-->
    <!--****** 宝贝儿，看见这个时候，删掉下面的统计代码哦~ ******-->
    <!--*********************************************************-->
	<script>
	  (function(i,s,o,g,r,a,m){
		  i['GoogleAnalyticsObject']=r;i[r]=i[r] || function(){
			(i[r].q=i[r].q||[]).push(arguments)}, i[r].l=1*new Date();
			a=s.createElement(o), m=s.getElementsByTagName(o)[0];
			a.async=1;
			a.src=g;
			m.parentNode.insertBefore(a,m)
	  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	  ga('create', 'UA-48535193-1', 'ningg.github.io');
	  ga('send', 'pageview');
	</script>
    
	
    <script type="text/javascript">
		function gotoTop(min_height){
			$("#gotoTop").click(
				function(){$('html,body').animate({scrollTop:0},700);
			}).hover(
				function(){$(this).addClass("hover");},
				function(){$(this).removeClass("hover");
			});
			min_height ? min_height = min_height : min_height = 600;
			$(window).scroll(function(){
				
				var s = $(window).scrollTop();
				
				if( s > min_height){
					$("#gotoTop").fadeIn(100);
				}else{
					$("#gotoTop").fadeOut(200);
				};
			});
		};
		gotoTop();

        $(function(){
            $('.home-follow').click(function(e){
                e.preventDefault();

                if($('.home-contact').is(':visible')){
                    $('.home-contact').slideUp(100);
                }else{
                    $('.home-contact').slideDown(100);
                }
            });
        })

    </script>
</body>
</html>
