<!DOCTYPE html>
<html xmlns:wb="http://open.weibo.com/wb">
<head>
    <!--   Author: NingG   -->
    <meta charset="utf-8" />
	<meta property="wb:webmaster" content="7ea7f3d5f3edad6a" />
    <title>MySQL安装 | ningg.top</title>
    <meta name="author" content="NingG" />
    <meta name="renderer" content="webkit">
    <meta name="description" content=" 经常要安装MySQL，虽然整理有文档，但每次都会遇到点问题，这次系统整理一下  " />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">

    <link rel="stylesheet" href="/css/default.css" type="text/css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="alternate" type="application/atom+xml" title="Recent Entries" href="" />
	
    <script src="/js/jquery-1.7.1.min.js" type="text/javascript"></script>
	<script src="http://tjs.sjs.sinajs.cn/open/api/js/wb.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</head>
<body>
	
    <div class="home-menu">
        <div class="home-icon-con">
            <a class="home-menu-icon" href="/">NingG</a>
            <a class="home-follow" href="#" title="Contact Me">+</a>
        </div>
        <div class="home-contact">
            <a href="http://weibo.com/ggningg/" target="_blank" style="margin-left:-5px;"><img src="http://www.weibo.com/favicon.ico" alt="" width="25"/></a>
            <a href="http://www.douban.com/people/ggningg/" target="_blank" style="text-align:center;"><img src="http://www.douban.com/favicon.ico" alt="" width="22"/></a>
			<a href="http://github.com/ningg" alt="" target="_blank" style="text-align:right;"><img src="/images/icon-cube-smaller.png" width="22"/></a>
        </div>
    </div>

    <link rel="stylesheet" href="/js/prettify/prettify.css" />
<style type="text/css">
    body { background:#e8e8e8; }
    @media screen and (max-width: 750px){
        body { background:#fff; }
    }
    @media screen and (max-width: 1020px){
        body { background:#fff; }
    }
</style>

<div id="content">
    <div class="entry">
        <h1 class="entry-title"><a href="/install-mysql" title="MySQL安装">MySQL安装</a></h1>
        <p class="entry-date">2014-10-13</p>
        <h2 id="section">背景</h2>

<p>“在服务器上装个MySQL，我要用。”“OK，稍等。”这么一稍等，就等了40mins，而且，自己之前整理的MySQL安装步骤，并不完整，借这次安装的机会，整理一下吧。</p>

<h2 id="mysql">安装MySQL</h2>

<p>通常安装MySQL分为几个基本步骤：本地安装MySQL、设置MySQL的root密码、开启MySQL允许远程访问。</p>

<h3 id="mysql-1">本地安装MySQL</h3>

<p>Linux环境下安装MySQL，有两种方式：rpm包方式、yum源方式（暂不考虑编译源代码方式）。</p>

<h4 id="rpm">rpm包方式</h4>

<p>到MySQL官网，下载MySQL社区开源版本，详细版本号为：MySQL-5.6.21-1.linux_glibc2.5.x86_64.rpm-bundle.tar。这是一个集合，包含了如下组件：</p>

<ul>
  <li>MySQL-server</li>
  <li>MySQL-client</li>
  <li>MySQL-embedded</li>
  <li>MySQL-shared</li>
  <li>MySQL-shared-compat</li>
  <li>MySQL-test</li>
  <li>MySQL-devel</li>
</ul>

<h5 id="mysql-2">1.解压MySQL安装包</h5>

<p>执行如下命令：</p>

<pre><code>[root@ningg mysql]#tar -xf MySQL-5.6.21-1.linux_glibc2.5.x86_64.rpm-bundle.tar
[root@ningg mysql]#ls
	MySQL-server-5.6.20-1.el6.x86_64.rpm
	MySQL-client-5.6.20-1.el6.x86_64.rpm      
	MySQL-shared-5.6.20-1.el6.x86_64.rpm
	MySQL-devel-5.6.20-1.el6.x86_64.rpm       
	MySQL-shared-compat-5.6.20-1.el6.x86_64.rpm
	MySQL-embedded-5.6.20-1.el6.x86_64.rpm    
	MySQL-test-5.6.20-1.el6.x86_64.rpm
</code></pre>

<h5 id="mysql-3">2.创建MySQL系统管理员</h5>

<p>执行如下命令：</p>

<pre><code>[root@ningg mysql]#groupadd mysql
[root@ningg mysql]#useradd -g mysql mysql
[root@ningg mysql]#id mysql
	uid=27(mysql) gid=27(mysql) groups=27(mysql)
</code></pre>

<h5 id="mysql-rpm">3.安装MySQL rpm包</h5>

<p>执行命令如下：</p>

<pre><code>[root@ningg mysql]#rpm -ivh "*.rpm"
Preparing...              ########### [100%]
   1:MySQL-devel          ########### [ 14%]
   2:MySQL-client         ########### [ 29%]
   3:MySQL-test           ########### [ 43%]
   4:MySQL-embedded       ########### [ 57%]
   5:MySQL-shared-compat  ########### [ 71%]
   6:MySQL-shared         ########### [ 86%]
   7:MySQL-server         ########### [100%]
</code></pre>

<p>补充一下，如果安装出现意外，希望卸载MySQL组件，则，卸载顺序如下：</p>

<pre><code>[root@ningg ~]# rpm -e MySQL-server-5.5.24-1.rhel5
[root@ningg ~]# rpm -e MySQL-embedded-5.5.24-1.rhel5
[root@ningg ~]# rpm -e MySQL-shared-5.5.24-1.rhel5
[root@ningg ~]# rpm -e MySQL-devel-5.5.24-1.rhel5
[root@ningg ~]# rpm -e MySQL-test-5.5.24-1.rhel5
[root@ningg ~]# rpm -e MySQL-client-5.5.24-1.rhel5
</code></pre>

<blockquote>
  <p>思考：如何保证是mysql用户启动的MySQL？如果使用root运行MySQL，一旦MySQL进程被Hacker控制，Hacker就拥有了root权限？</p>
</blockquote>

<h4 id="yum">yum源方式</h4>

<p>（doing…）</p>

<h3 id="mysqlroot">设置MySQL的root密码</h3>

<p>更详细内容参考<a href="http://dev.mysql.com/doc/mysql-security-excerpt/5.6/en/user-account-management.html">MySQL 5.6 Manual: User account management</a></p>

<h4 id="mysql-4">1.修改MySQL启动配置</h4>

<p>查找<code>my.cnf</code>文件位置，两个命令：<code>locate "my.cnf"</code>和<code>find / -name "my.cnf"</code>（备注：两个命令有差异，具体参考<a href="http://312788172.iteye.com/blog/730280">文章</a>）。
通常文件位置<code>/etc/my.cnf</code>或者<code>/usr/my.cnf</code>，依具体情况行事，在其中设置不启用授权表：</p>

<pre><code>[root@ningg mysql]# vim /usr/my.cnf
# For advice on how to change settings please see
# http://dev.mysql.com/doc/refman/5.6/en/server-configuration-defaults.html

[mysqld]
# 新增加下面一行，含义：设置不启用授权表
skip-grant-tables
</code></pre>

<h4 id="root">2.重置root密码</h4>

<p>重新启动MySQL：<code>service mysql restart</code>，然后进行如下操作：</p>

<pre><code>[root@ningg mysql]# mysql

mysql&gt; use mysql
mysql&gt; update user set Password=PASSWORD('1234') where User='root';
mysql&gt; flush privileges;
</code></pre>

<p>之后，修改<code>my.cnf</code>文件，注释掉<code>skip-grant-tables</code>；然后，重启MySQL：<code>service mysql restart</code>。</p>

<h4 id="section-1">3.补充说明</h4>

<p>针对msyql数据库下的user表，说明几点：</p>

<pre><code>mysql&gt; use mysql
#使用下面命令查看表格当前记录
mysql&gt; select * from user \G;
#查看user表格的字段类型
mysql&gt; describe user;
#查看Host\User\Password字段；
mysql&gt; select host,user,password from user;
+-----------+------+---------------+
| host      | user | password      |
+-----------+------+---------------+
| %         | root | *81B936FD50F6 |
| cib02167  | root | *81B936FD50F6 |
| 127.0.0.1 | root | *81B936FD50F6 |
| ::1       | root | *81B936FD50F6 |
+-----------+------+---------------+
</code></pre>

<p>具体：</p>

<ul>
  <li>user表：用户信息、用户权限、密码、可以登录访问的远端主机等。</li>
  <li>host字段：表示登录MySQL的主机，可以是IP、主机名，如果为<code>%</code>则表示任何客户端主机都能登录，建议开发时，设置为<code>%</code>。</li>
</ul>

<p>命令SET PASSWORD</p>

<pre><code>#设置用户在不同主机环境下的登录密码
SET PASSWORD FOR 'root'@'%' = PASSWORD('newpass');
</code></pre>

<p>命令UPDATE</p>

<pre><code># 可修改user表格内容（MySQL不区分大小写）
update user set password=password('new-pw') where user='root' and host='%';
</code></pre>

<p>更新授权表</p>

<pre><code># 修改用户信息等，务必flush
flush privileges
</code></pre>

<h3 id="mysql-5">开启MySQL允许远程访问</h3>

<p>在user表中，添加一条<code>user=root</code>且<code>host=%</code>的记录，并且通过SET PASSWORD命令重置密码即可。host字段取值<code>%</code>，即表示任何客户端机器，涵盖远程访问的机器。</p>

<pre><code># 可修改user表格内容（MySQL不区分大小写）
update user set password=password('new-pw') where user='root' and host='%';
</code></pre>

<blockquote>
  <p>疑问：如果没有<code>user=root</code>且<code>host=%</code>的记录怎么办？</p>

  <p>RE：新建一条记录，或者将<code>user=root</code>的记录，利用update命令修改为<code>host=%</code>，比较官方的做法，添加一个用户root@%即可；参考官网：<a href="http://dev.mysql.com/doc/mysql-security-excerpt/5.6/en/adding-users.html">adding users</a></p>
</blockquote>

<h2 id="section-2">常见问题</h2>

<p><strong>问题1</strong>：You must SET PASSWORD before executing this statement</p>

<p>解决办法：根据提示直接使用set password命令重置密码即可，如下：</p>

<pre><code>mysql&gt; set password=password('new-pw');
</code></pre>

<p><strong>问题2</strong>：这个本质上是不是MySQL的管理问题？有哪些用户，哪些用户可以远程登录？</p>

<p>回应：是的，你很用心在思考，官方文档有很多细节，很有意思的，可以看一下，具体：<code>MySQL Manual</code>–<code>Security in MySQL</code>–<code>User Account Management</code>，有详尽的说明。</p>

<p><strong>问题3</strong>：MySQL上如何新增/删除用户？参考<a href="http://dev.mysql.com/doc/mysql-security-excerpt/5.6/en/adding-users.html">adding users</a>和<a href="http://dev.mysql.com/doc/mysql-security-excerpt/5.6/en/removing-users.html">removing users</a></p>

<pre><code>-- 先刷新一下权限（避免问题发生）
flush privileges;

-- 创建用户 test:passwd
create user 'test'@'%' identified by 'passwd';

-- 为用户分配权限
grant all privileges on *.* to 'test'@'%' with grant option;

-- 查看用户权限
show grants for 'test'@'%';

-- 删除用户
drop user 'test'@'%';
</code></pre>

<h2 id="section-3">参考来源</h2>

<ul>
  <li><a href="http://dev.mysql.com/doc/mysql-security-excerpt/5.6/en/grant-table-structure.html">MySQL 5.6 Manual: Privilege system grant tables</a></li>
  <li><a href="http://dev.mysql.com/doc/mysql-security-excerpt/5.6/en/user-account-management.html">MySQL 5.6 Manual: User account management</a></li>
  <li><a href="http://dev.mysql.com/downloads/mysql/">MySQL开源社区版本下载地址</a></li>
  <li><a href="http://dev.mysql.com/doc/">MySQL官方文档下载地址</a></li>
  <li><a href="http://312788172.iteye.com/blog/730280">linux下which、whereis、locate、find 命令的区别</a></li>
</ul>

<h2 id="section-4">闲谈</h2>

<p>这篇文章，写的都是小问题，如果读过MySQL的官方文档，就知道<code>User Account Management</code>的基本知识了，也不用遇到什么问题就蒙圈了，用一个东西，先浏览学习一下官方文档很必要的，看似浪费时间，其实是捷径。当然，一个个小问题折磨自己，才让我意识到读一遍MySQL官方文档的好处。</p>



        <div id="disqus_container">
            <div style="margin-bottom:20px" class="right">
				<wb:share-button appkey="2306590132" addition="simple" type="button" ralateUid="2356527183"></wb:share-button>
            </div>
            <!--<a href="#" class="comment" onclick="return false;">点击查看评论</a>-->
            <div id="disqus_thread"></div>
        </div>
    </div>

	
    <div class="sidenav">
		<iframe width="100%" height="75" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=550&fansRow=2&ptype=1&speed=0&skin=1&isTitle=0&noborder=0&isWeibo=0&isFans=0&uid=2356527183&verifier=1ccfb61e&colors=d6f3f7,ffffff,666666,0082cb,ecfbfd&dpc=1"></iframe>
    </div>

</div>

<script src="/js/post.js" type="text/javascript"></script>


	<div id="gotoTop">Top</div>


    <!--*********************************************************-->
    <!--****** 宝贝儿，看见这个时候，删掉下面的统计代码哦~ ******-->
    <!--*********************************************************-->
	<script>
	  (function(i,s,o,g,r,a,m){
		  i['GoogleAnalyticsObject']=r;i[r]=i[r] || function(){
			(i[r].q=i[r].q||[]).push(arguments)}, i[r].l=1*new Date();
			a=s.createElement(o), m=s.getElementsByTagName(o)[0];
			a.async=1;
			a.src=g;
			m.parentNode.insertBefore(a,m)
	  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	  ga('create', 'UA-48535193-1', 'ningg.github.io');
	  ga('send', 'pageview');
	</script>
    
	
    <script type="text/javascript">
		function gotoTop(min_height){
			$("#gotoTop").click(
				function(){$('html,body').animate({scrollTop:0},700);
			}).hover(
				function(){$(this).addClass("hover");},
				function(){$(this).removeClass("hover");
			});
			min_height ? min_height = min_height : min_height = 600;
			$(window).scroll(function(){
				
				var s = $(window).scrollTop();
				
				if( s > min_height){
					$("#gotoTop").fadeIn(100);
				}else{
					$("#gotoTop").fadeOut(200);
				};
			});
		};
		gotoTop();

        $(function(){
            $('.home-follow').click(function(e){
                e.preventDefault();

                if($('.home-contact').is(':visible')){
                    $('.home-contact').slideUp(100);
                }else{
                    $('.home-contact').slideDown(100);
                }
            });
        })

    </script>
</body>
</html>
