<!DOCTYPE html>
<html xmlns:wb="http://open.weibo.com/wb">
<head>
    <!--   Author: NingG   -->
    <meta charset="utf-8" />
	<meta property="wb:webmaster" content="7ea7f3d5f3edad6a" />
    <title>Flume 1.5.0.1 User Guide：Flume Channels | ningg.top</title>
    <meta name="author" content="NingG" />
    <meta name="renderer" content="webkit">
    <meta name="description" content=" Flume中重要组件channel的详细介绍  " />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">

    <link rel="stylesheet" href="/css/default.css" type="text/css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="alternate" type="application/atom+xml" title="Recent Entries" href="" />
	
    <script src="/js/jquery-1.7.1.min.js" type="text/javascript"></script>
	<script src="http://tjs.sjs.sinajs.cn/open/api/js/wb.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</head>
<body>
	
    <div class="home-menu">
        <div class="home-icon-con">
            <a class="home-menu-icon" href="/">NingG</a>
            <a class="home-follow" href="#" title="Contact Me">+</a>
        </div>
        <div class="home-contact">
            <a href="http://weibo.com/ggningg/" target="_blank" style="margin-left:-5px;"><img src="http://www.weibo.com/favicon.ico" alt="" width="25"/></a>
            <a href="http://www.douban.com/people/ggningg/" target="_blank" style="text-align:center;"><img src="http://www.douban.com/favicon.ico" alt="" width="22"/></a>
			<a href="http://github.com/ningg" alt="" target="_blank" style="text-align:right;"><img src="/images/icon-cube-smaller.png" width="22"/></a>
        </div>
    </div>

    <link rel="stylesheet" href="/js/prettify/prettify.css" />
<style type="text/css">
    body { background:#e8e8e8; }
    @media screen and (max-width: 750px){
        body { background:#fff; }
    }
    @media screen and (max-width: 1020px){
        body { background:#fff; }
    }
</style>

<div id="content">
    <div class="entry">
        <h1 class="entry-title"><a href="/flume-user-guide-channel" title="Flume 1.5.0.1 User Guide：Flume Channels">Flume 1.5.0.1 User Guide：Flume Channels</a></h1>
        <p class="entry-date">2014-10-25</p>
        <p>Channels are the repositories where the events are staged on a agent. Source adds the events and Sink removes it.
（agent中events存储在channels中：source将events添加到channels，sink从channels中读取events）</p>

<h2 id="memory-channel">Memory Channel</h2>

<p>The events are stored in an in-memory queue with configurable max size. It’s ideal for flows that need higher throughput and are prepared to lose the staged data in the event of a agent failures. Required properties are in bold.
（events被储存在in-memory queue中，queue的大小可以设定；适用场景：高吞吐量、在agent fail时允许lose data。）</p>

<table>
  <thead>
    <tr>
      <th>Property Name</th>
      <th>Default</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>type</strong></td>
      <td>–</td>
      <td>The component type name, needs to be <code>memory</code></td>
    </tr>
    <tr>
      <td>capacity</td>
      <td>100</td>
      <td>The maximum number of events stored in the channel</td>
    </tr>
    <tr>
      <td>transactionCapacity</td>
      <td>100</td>
      <td>The maximum number of events the channel will take from a source or give to a sink per transaction</td>
    </tr>
    <tr>
      <td>keep-alive</td>
      <td>3</td>
      <td>Timeout in seconds for adding or removing an event</td>
    </tr>
    <tr>
      <td>byteCapacityBufferPercentage</td>
      <td>20</td>
      <td>Defines the percent of buffer between byteCapacity and the estimated total size of all events in the channel, to account for data in headers. See below.<strong>（什么意思？）</strong></td>
    </tr>
    <tr>
      <td>byteCapacity</td>
      <td>see description</td>
      <td>Maximum total bytes of memory allowed as a sum of all events in this channel. The implementation only counts the Event <code>body</code>, which is the reason for providing the <code>byteCapacityBufferPercentage</code> configuration parameter as well. Defaults to a computed value equal to 80% of the maximum memory available to the JVM (i.e. 80% of the -Xmx value passed on the command line). Note that if you have multiple memory channels on a single JVM, and they happen to hold the same physical events (i.e. if you are using a replicating channel selector from a single source) then those event sizes may be double-counted for channel byteCapacity purposes. Setting this value to 0 will cause this value to fall back to a hard internal limit of about 200 GB.（设置为0，则参数取值为a hard internal limit，通常为200GB；）</td>
    </tr>
  </tbody>
</table>

<p><strong>notes(ningg)</strong>：<code>byteCapacityBufferPercentage</code>参数的含义？event是由header和body构成的，参数<code>byteCapacity</code>约束的只是<code>body</code>，因此，新增了<code>byteCapacityBufferPercentage</code>参数，表示<code>header</code>的占用空间的的比例。</p>

<p>Example for agent named a1:</p>

<pre><code>a1.channels = c1
a1.channels.c1.type = memory
a1.channels.c1.capacity = 10000
a1.channels.c1.transactionCapacity = 10000
a1.channels.c1.byteCapacityBufferPercentage = 20
a1.channels.c1.byteCapacity = 800000
</code></pre>

<h2 id="jdbc-channel">JDBC Channel</h2>

<p>The events are stored in a persistent storage that’s backed by a database. The JDBC channel currently supports embedded Derby. This is a durable channel that’s ideal for flows where recoverability is important. Required properties are in bold.
（将events持久化存储在database中，当前JDBC channel支持embeded Derby；适用于数据流可恢复性要求较高的场景。）</p>

<table>
  <thead>
    <tr>
      <th>Property Name</th>
      <th>Default</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>type</strong></td>
      <td>–</td>
      <td>The component type name, needs to be jdbc</td>
    </tr>
    <tr>
      <td>db.type</td>
      <td>DERBY</td>
      <td>Database vendor, needs to be DERBY.</td>
    </tr>
    <tr>
      <td>driver.class</td>
      <td>org.apache.derby.jdbc.EmbeddedDriver</td>
      <td>Class for vendor’s JDBC driver</td>
    </tr>
    <tr>
      <td>driver.url</td>
      <td>(constructed from other properties)</td>
      <td>JDBC connection URL</td>
    </tr>
    <tr>
      <td>db.username</td>
      <td>“sa”</td>
      <td>User id for db connection</td>
    </tr>
    <tr>
      <td>db.password</td>
      <td>–</td>
      <td>password for db connection</td>
    </tr>
    <tr>
      <td>connection.properties.file</td>
      <td>–</td>
      <td>JDBC Connection property file path</td>
    </tr>
    <tr>
      <td>create.schema</td>
      <td>true</td>
      <td>If true, then creates db schema if not there</td>
    </tr>
    <tr>
      <td>create.index</td>
      <td>true</td>
      <td>Create indexes to speed up lookups</td>
    </tr>
    <tr>
      <td>create.foreignkey</td>
      <td>true</td>
      <td> </td>
    </tr>
    <tr>
      <td>transaction.isolation</td>
      <td>“READ_COMMITTED”</td>
      <td>Isolation level for db session READ_UNCOMMITTED, READ_COMMITTED, SERIALIZABLE, REPEATABLE_READ</td>
    </tr>
    <tr>
      <td>maximum.connections</td>
      <td>10</td>
      <td>Max connections allowed to db</td>
    </tr>
    <tr>
      <td>maximum.capacity</td>
      <td>0 (unlimited)</td>
      <td>Max number of events in the channel</td>
    </tr>
    <tr>
      <td>sysprop.*</td>
      <td> </td>
      <td>DB Vendor specific properties</td>
    </tr>
    <tr>
      <td>sysprop.user.home</td>
      <td> </td>
      <td>Home path to store embedded Derby database</td>
    </tr>
  </tbody>
</table>

<p>Example for agent named a1:</p>

<pre><code>a1.channels = c1
a1.channels.c1.type = jdbc
</code></pre>

<h2 id="file-channel">File Channel</h2>

<p>（todo）</p>

<h2 id="spillable-memory-channel">Spillable Memory Channel</h2>

<p>The events are stored in an in-memory queue and on disk. The in-memory queue serves as the primary store and the disk as overflow. The disk store is managed using an embedded File channel. When the in-memory queue is full, additional incoming events are stored in the file channel. This channel is ideal for flows that need high throughput of memory channel during normal operation, but at the same time need the larger capacity of the file channel for better tolerance of intermittent sink side outages or drop in drain rates. The throughput will reduce approximately to file channel speeds during such abnormal situations. In case of an agent crash or restart, only the events stored on disk are recovered when the agent comes online. <strong>This channel is currently experimental and not recommended for use in production</strong>.</p>

<p><strong>notes(ningg)</strong>：Spillable Memory Channel当前还是试验阶段，不推荐在生产环境中使用。</p>

<h2 id="pseudo-transaction-channel">Pseudo Transaction Channel</h2>

<p>Warning The Pseudo Transaction Channel is only for unit testing purposes and is NOT meant for production use.
Required properties are in bold.
（<strong>Warning</strong>：Pseudo Transaction Channel，当前用于unit testing；不要用于生产环境）</p>

<table>
  <thead>
    <tr>
      <th>Property Name</th>
      <th>Default</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>type</strong></td>
      <td>–</td>
      <td>The component type name, needs to be <code>org.apache.flume.channel.PseudoTxnMemoryChannel</code></td>
    </tr>
    <tr>
      <td>capacity</td>
      <td>50</td>
      <td>The max number of events stored in the channel</td>
    </tr>
    <tr>
      <td>keep-alive</td>
      <td>3</td>
      <td>Timeout in seconds for adding or removing an event</td>
    </tr>
  </tbody>
</table>

<h2 id="custom-channel">Custom Channel</h2>

<p>A custom channel is your own implementation of the Channel interface. A custom channel’s class and its dependencies must be included in the agent’s classpath when starting the Flume agent. The type of the custom channel is its FQCN. Required properties are in bold.</p>

<table>
  <thead>
    <tr>
      <th>Property Name</th>
      <th>Default</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>type</strong></td>
      <td>–</td>
      <td>The component type name, needs to be a <code>FQCN</code></td>
    </tr>
  </tbody>
</table>

<p>Example for agent named a1:</p>

<pre><code>a1.channels = c1
a1.channels.c1.type = org.example.MyChannel
</code></pre>



        <div id="disqus_container">
            <div style="margin-bottom:20px" class="right">
				<wb:share-button appkey="2306590132" addition="simple" type="button" ralateUid="2356527183"></wb:share-button>
            </div>
            <!--<a href="#" class="comment" onclick="return false;">点击查看评论</a>-->
            <div id="disqus_thread"></div>
        </div>
    </div>

	
    <div class="sidenav">
		<iframe width="100%" height="75" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=550&fansRow=2&ptype=1&speed=0&skin=1&isTitle=0&noborder=0&isWeibo=0&isFans=0&uid=2356527183&verifier=1ccfb61e&colors=d6f3f7,ffffff,666666,0082cb,ecfbfd&dpc=1"></iframe>
    </div>

</div>

<script src="/js/post.js" type="text/javascript"></script>


	<div id="gotoTop">Top</div>


    <!--*********************************************************-->
    <!--****** 宝贝儿，看见这个时候，删掉下面的统计代码哦~ ******-->
    <!--*********************************************************-->
	<script>
	  (function(i,s,o,g,r,a,m){
		  i['GoogleAnalyticsObject']=r;i[r]=i[r] || function(){
			(i[r].q=i[r].q||[]).push(arguments)}, i[r].l=1*new Date();
			a=s.createElement(o), m=s.getElementsByTagName(o)[0];
			a.async=1;
			a.src=g;
			m.parentNode.insertBefore(a,m)
	  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	  ga('create', 'UA-48535193-1', 'ningg.github.io');
	  ga('send', 'pageview');
	</script>
    
	
    <script type="text/javascript">
		function gotoTop(min_height){
			$("#gotoTop").click(
				function(){$('html,body').animate({scrollTop:0},700);
			}).hover(
				function(){$(this).addClass("hover");},
				function(){$(this).removeClass("hover");
			});
			min_height ? min_height = min_height : min_height = 600;
			$(window).scroll(function(){
				
				var s = $(window).scrollTop();
				
				if( s > min_height){
					$("#gotoTop").fadeIn(100);
				}else{
					$("#gotoTop").fadeOut(200);
				};
			});
		};
		gotoTop();

        $(function(){
            $('.home-follow').click(function(e){
                e.preventDefault();

                if($('.home-contact').is(':visible')){
                    $('.home-contact').slideUp(100);
                }else{
                    $('.home-contact').slideDown(100);
                }
            });
        })

    </script>
</body>
</html>
