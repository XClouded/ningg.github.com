<!DOCTYPE html>
<html xmlns:wb="http://open.weibo.com/wb">
<head>
    <!--   Author: NingG   -->
    <meta charset="utf-8" />
	<meta property="wb:webmaster" content="7ea7f3d5f3edad6a" />
    <title>jmxtrans入门 | ningg.top</title>
    <meta name="author" content="NingG" />
    <meta name="renderer" content="webkit">
    <meta name="description" content=" 这个能够收集JVM中运行进程的状态，并将状态数据发送给多种展示平台  " />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">

    <link rel="stylesheet" href="/css/default.css" type="text/css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="alternate" type="application/atom+xml" title="Recent Entries" href="" />
	
    <script src="/js/jquery-1.7.1.min.js" type="text/javascript"></script>
	<script src="http://tjs.sjs.sinajs.cn/open/api/js/wb.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</head>
<body>
	
    <div class="home-menu">
        <div class="home-icon-con">
            <a class="home-menu-icon" href="/">NingG</a>
            <a class="home-follow" href="#" title="Contact Me">+</a>
        </div>
        <div class="home-contact">
            <a href="http://weibo.com/ggningg/" target="_blank" style="margin-left:-5px;"><img src="http://www.weibo.com/favicon.ico" alt="" width="25"/></a>
            <a href="http://www.douban.com/people/ggningg/" target="_blank" style="text-align:center;"><img src="http://www.douban.com/favicon.ico" alt="" width="22"/></a>
			<a href="http://github.com/ningg" alt="" target="_blank" style="text-align:right;"><img src="/images/icon-cube-smaller.png" width="22"/></a>
        </div>
    </div>

    <link rel="stylesheet" href="/js/prettify/prettify.css" />
<style type="text/css">
    body { background:#e8e8e8; }
    @media screen and (max-width: 750px){
        body { background:#fff; }
    }
    @media screen and (max-width: 1020px){
        body { background:#fff; }
    }
</style>

<div id="content">
    <div class="entry">
        <h1 class="entry-title"><a href="/intro-to-jmxtrans" title="jmxtrans入门">jmxtrans入门</a></h1>
        <p class="entry-date">2014-12-12</p>
        <p>（doing…）</p>

<p>几个方面：</p>

<ul>
  <li>jmxtrans有什么作用？</li>
  <li>如何安装？
    <ul>
      <li>从<a href="https://github.com/jmxtrans/jmxtrans/downloads">jmxtrans download</a>下载了一个rpm包，下文将参考<a href="https://github.com/jmxtrans/jmxtrans/wiki/Installation">jmxtrans Installation</a>来安装jmxtrans；</li>
      <li></li>
    </ul>
  </li>
  <li>基本使用？（通过jmxtrans向Ganglia发送数据）
    <ul>
      <li>基本原理</li>
      <li>jmxtrans涉及的配置</li>
    </ul>
  </li>
</ul>

<h2 id="installing-the-rpm">Installing the RPM</h2>

<p>There is a <code>.rpm</code> file which you can download and install on an Fedora/CentOS/RHEL machine. This makes setting up the application trivial and is highly recommended. It also makes upgrades painless as well.</p>

<p>To install it:</p>

<ol>
  <li>Download the <a href="https://github.com/jmxtrans/jmxtrans/downloads">.rpm package</a>.</li>
  <li>As root: <code>rpm -i jmxtrans_239-0.noarch.rpm</code> (replace the version number)</li>
  <li>Enter in the JVM heap size you want: <code>512 (megs)</code> is the default. The more JVM’s you need to monitor, the more memory you will probably need. If you are getting OutOfMemoryError’s, then increase this value by editing <code>/etc/sysconfig/jmxtrans</code>.</li>
</ol>

<p>Notes:</p>

<ul>
  <li>The application is installed in: <code>/usr/share/jmxtrans</code></li>
  <li>Configuration options are stored in: <code>/etc/sysconfig/jmxtrans</code></li>
  <li>There is an init script in: <code>/etc/init.d/jmxtrans</code> (this wraps the <code>jmxtrans.sh</code> discussed below)</li>
  <li>Put your .json files into: <code>/var/lib/jmxtrans</code></li>
</ul>

<h2 id="running-jmx-transformer">Running Jmx Transformer</h2>

<p>There is a <code>jmxtrans.sh</code> script included with the distribution. This should be used to start the application running. If you read through the script, you will see that all of the options are customizable by exporting environment variables without having to edit the <code>.sh</code> script. You can even create a <code>jmxtrans.conf</code> file to put the options into so that you don’t need to setup environment variables yourself.</p>

<p>To run jmxtrans:</p>

<pre><code>./jmxtrans.sh start [optional path to one json file]
</code></pre>

<p>To stop jmxtrans:</p>

<pre><code>./jmxtrans.sh stop
</code></pre>

<p>Options you may want to configure:</p>

<ul>
  <li>JSON_DIR - Location of your .json files. Defaults to ‘.’</li>
  <li>LOG_DIR - Location of where the log files get written. Defaults to ‘.’</li>
  <li>SECONDS_BETWEEN_RUNS - How often jobs run. Defaults to 60.</li>
</ul>

<p>上面这些参数都可以在<code>/etc/sysconfig/jmxtrans</code>中进行配置；另外，上面通过shell方式启动jmxtrans没有问题，为了方便可以，可以将jmxtrans加入到系统服务，具体如下：</p>

<pre><code>[root@ningg ~]# chkconfig --add jmxtrans
[root@ningg ~]# service start jmxtrans
Starting jmxtrans: Cannot execute /usr/bin/jps -l!
[root@ningg ~]# which jps
/usr/java/default/bin/jps
[root@ningg ~]# vim /etc/sysconfig/jmxtrans
#增加JAVA_HOME的配置(与上面jps的位置对应)
export JAVA_HOME=/usr/java/default
[root@ningg ~]# service jmxtrans start
Starting jmxtrans:                           [  OK  ]
</code></pre>

<h2 id="enabling-jmx-for-a-jvm">Enabling JMX for a JVM</h2>

<p>In order to use jmxtrans, you must first enable Java Management Extensions (JMX) on your Java Virtual Machine (JVM). We recommend that you connect to Java 6 (or greater) JVM’s because there are improvements to the JMX protocol that we can take advantage of, such as wildcard (<code>*</code>) queries.</p>

<p>For applications behind a firewall that do not need security, add these arguments to the startup of the JVM in order to enable remote JMX connections:</p>

<pre><code>-Dcom.sun.management.jmxremote.port=1105 \
-Dcom.sun.management.jmxremote.authenticate=false \
-Dcom.sun.management.jmxremote.ssl=false
</code></pre>

<p>You should set the port number to any free port number on your machine that is above 1024.</p>

<p>For more details on enabling the agent, please read:</p>

<ul>
  <li><a href="http://download.oracle.com/javase/6/docs/technotes/guides/management/agent.html">JMX Agent Configuration</a></li>
  <li><a href="http://download.oracle.com/javase/6/docs/technotes/guides/management/">Monitoring and Management</a></li>
</ul>

<h2 id="jconsole">JConsole</h2>

<p>If you are going to use jmxtrans, it is helpful to gain an understanding of JConsole. This is a good visual tool for viewing attributes in a JVM. Using this tool will help you write your jmxtrans queries.</p>

<ul>
  <li><a href="http://download.oracle.com/javase/6/docs/technotes/guides/management/jconsole.html">JConsole Documentation</a></li>
</ul>

<h2 id="using-ant-vars">Using Ant Vars</h2>

<p>Ant like variables could be used in json files since v239, so you could avoid hardcoding some values, like graphite servers.</p>

<h3 id="before">Before</h3>

<pre><code>{
  "servers" : [ {
    "port" : "1099",
    "host" : "w2",
    "queries" : [ {
      "obj" : "java.lang:type=Memory",
      "attr" : [ "HeapMemoryUsage", "NonHeapMemoryUsage" ],
      "outputWriters" : [ {
        "@class" : "com.googlecode.jmxtrans.model.output.GraphiteWriter",
        "settings" : {
          "port" : 2003,
          "host" : "192.168.192.133"
        }
      } ]
    } ]
  } ]
}
</code></pre>

<h3 id="now">Now</h3>

<pre><code>{
  "servers" : [ {
    "port" : "${myserverport}",
    "host" : "${myserverhost}",
    "queries" : [ {
      "obj" : "java.lang:type=Memory",
      "attr" : [ "HeapMemoryUsage", "NonHeapMemoryUsage" ],
      "outputWriters" : [ {
        "@class" : "com.googlecode.jmxtrans.model.output.GraphiteWriter",
        "settings" : {
          "port" : "${mygraphiteport}",
          "host" : "${mygraphitehost}"
        }
      } ]
    } ]
  } ]
}
</code></pre>

<h3 id="notice">Notice</h3>

<p>Double-quotes (<code>"</code>) should be using even when providing int values, like port, it’s mandatory for StringResolver, String to Int conversion will be done internally.</p>

<p>Variables should be provided via <code>-D</code> for example via <code>JMXTRANS_OPTS</code> in <code>jmxtrans.conf</code> :</p>

<pre><code>JMXTRANS_OPTS="-Dmyserverport=1099 -Dmyserverhost=w2 -Dmygraphiteport=2003 -Dmygraphitehost=192.168.192.133"
</code></pre>



        <div id="disqus_container">
            <div style="margin-bottom:20px" class="right">
				<wb:share-button appkey="2306590132" addition="simple" type="button" ralateUid="2356527183"></wb:share-button>
            </div>
            <!--<a href="#" class="comment" onclick="return false;">点击查看评论</a>-->
            <div id="disqus_thread"></div>
        </div>
    </div>

	
    <div class="sidenav">
		<iframe width="100%" height="75" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=550&fansRow=2&ptype=1&speed=0&skin=1&isTitle=0&noborder=0&isWeibo=0&isFans=0&uid=2356527183&verifier=1ccfb61e&colors=d6f3f7,ffffff,666666,0082cb,ecfbfd&dpc=1"></iframe>
    </div>

</div>

<script src="/js/post.js" type="text/javascript"></script>


	<div id="gotoTop">Top</div>


    <!--*********************************************************-->
    <!--****** 宝贝儿，看见这个时候，删掉下面的统计代码哦~ ******-->
    <!--*********************************************************-->
	<script>
	  (function(i,s,o,g,r,a,m){
		  i['GoogleAnalyticsObject']=r;i[r]=i[r] || function(){
			(i[r].q=i[r].q||[]).push(arguments)}, i[r].l=1*new Date();
			a=s.createElement(o), m=s.getElementsByTagName(o)[0];
			a.async=1;
			a.src=g;
			m.parentNode.insertBefore(a,m)
	  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	  ga('create', 'UA-48535193-1', 'ningg.github.io');
	  ga('send', 'pageview');
	</script>
    
	
    <script type="text/javascript">
		function gotoTop(min_height){
			$("#gotoTop").click(
				function(){$('html,body').animate({scrollTop:0},700);
			}).hover(
				function(){$(this).addClass("hover");},
				function(){$(this).removeClass("hover");
			});
			min_height ? min_height = min_height : min_height = 600;
			$(window).scroll(function(){
				
				var s = $(window).scrollTop();
				
				if( s > min_height){
					$("#gotoTop").fadeIn(100);
				}else{
					$("#gotoTop").fadeOut(200);
				};
			});
		};
		gotoTop();

        $(function(){
            $('.home-follow').click(function(e){
                e.preventDefault();

                if($('.home-contact').is(':visible')){
                    $('.home-contact').slideUp(100);
                }else{
                    $('.home-contact').slideDown(100);
                }
            });
        })

    </script>
</body>
</html>
